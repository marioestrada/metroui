(function(a){a.toJSON=function(b){if("object"==typeof JSON&&JSON.stringify)return JSON.stringify(b);var d=typeof b;if(null===b)return"null";if("undefined"!=d){if("number"==d||"boolean"==d)return b+"";if("string"==d)return a.quoteString(b);if("object"==d){if("function"==typeof b.toJSON)return a.toJSON(b.toJSON());if(b.constructor===Date){var f=b.getUTCMonth()+1;10>f&&(f="0"+f);var h=b.getUTCDate();10>h&&(h="0"+h);var d=b.getUTCFullYear(),j=b.getUTCHours();10>j&&(j="0"+j);var i=b.getUTCMinutes();10>
i&&(i="0"+i);var m=b.getUTCSeconds();10>m&&(m="0"+m);b=b.getUTCMilliseconds();100>b&&(b="0"+b);10>b&&(b="0"+b);return'"'+d+"-"+f+"-"+h+"T"+j+":"+i+":"+m+"."+b+'Z"'}if(b.constructor===Array){f=[];for(h=0;h<b.length;h++)f.push(a.toJSON(b[h])||"null");return"["+f.join(",")+"]"}f=[];for(h in b){d=typeof h;if("number"==d)d='"'+h+'"';else if("string"==d)d=a.quoteString(h);else continue;"function"!=typeof b[h]&&(j=a.toJSON(b[h]),f.push(d+":"+j))}return"{"+f.join(", ")+"}"}}};a.evalJSON=function(a){return"object"==
typeof JSON&&JSON.parse?JSON.parse(a):eval("("+a+")")};a.secureEvalJSON=function(a){if("object"==typeof JSON&&JSON.parse)return JSON.parse(a);var b;b=a.replace(/\\["\\\/bfnrtu]/g,"@");b=b.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");b=b.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(b))return eval("("+a+")");throw new SyntaxError("Error parsing JSON, source is not valid.");};a.quoteString=function(a){return a.match(d)?'"'+a.replace(d,function(a){var c=
b[a];if("string"===typeof c)return c;c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+a+'"'};var d=/["\\\x00-\x1f\x7f-\x9f]/g,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}})(jQuery);window.raptor={};window.exports||(window.exports={});window.config||(window.config={});Array.prototype.invert||(Array.prototype.invert=function(){for(var a={},d=0,b=this.length;d<b;++d)a[this[d]]=d;return a});
function decode_location_params(){var a=window.location.href.slice(window.location.href.indexOf("?")+1,window.location.href.length);a.indexOf("#")!=-1&&(a=a.slice(0,a.indexOf("#")));for(var a=a.split("&"),d={},b=0;b<a.length;b++){var c=a[b].split("=");d[c[0]]=decodeURIComponent(c[1])}return d}var window_urlparams=decode_location_params();
function getfiles_enabled(){return window.utweb&&utweb.current_client()&&utweb.current_client().plus_features("proxy_files")?true:config.local_discovery||config.debug||config.webui||config.experimental||config.dev_mode};(function(){var a=this,d=a._,b="undefined"!==typeof StopIteration?StopIteration:"__break__",c=Array.prototype,e=Object.prototype,f=c.slice,h=c.unshift,j=e.toString,i=e.hasOwnProperty,m=c.forEach,l=c.map,n=c.reduce,o=c.reduceRight,p=c.filter,r=c.every,s=c.some,t=c.indexOf,u=c.lastIndexOf,e=Array.isArray,x=Object.keys,g=function(a){return new v(a)};"undefined"!==typeof exports&&(exports._=g);a._=g;g.VERSION="1.1.2";var q=g.each=g.forEach=function(a,c,d){try{if(m&&a.forEach===m)a.forEach(c,d);else if(g.isNumber(a.length))for(var f=
0,e=a.length;f<e;f++)c.call(d,a[f],f,a);else for(f in a)i.call(a,f)&&c.call(d,a[f],f,a)}catch(q){if(q!=b)throw q;}return a};g.map=function(a,b,c){if(l&&a.map===l)return a.map(b,c);var d=[];q(a,function(a,g,f){d[d.length]=b.call(c,a,g,f)});return d};g.reduce=g.foldl=g.inject=function(a,b,c,d){if(typeof c=="function")var f=c,c=b,b=f;if(n&&a.reduce===n){d&&(b=g.bind(b,d));return a.reduce(b,c)}q(a,function(a,g,f){c=b.call(d,c,a,g,f)});return c};g.reduceRight=g.foldr=function(a,b,c,d){if(o&&a.reduceRight===
o){d&&(b=g.bind(b,d));return a.reduceRight(b,c)}a=(g.isArray(a)?a.slice():g.toArray(a)).reverse();return g.reduce(a,b,c,d)};g.find=g.detect=function(a,b,c){var d;q(a,function(a,f,e){if(b.call(c,a,f,e)){d=a;g.breakLoop()}});return d};g.filter=g.select=function(a,b,c){if(p&&a.filter===p)return a.filter(b,c);var d=[];q(a,function(a,g,f){b.call(c,a,g,f)&&(d[d.length]=a)});return d};g.reject=function(a,b,c){var d=[];q(a,function(a,g,f){b.call(c,a,g,f)||(d[d.length]=a)});return d};g.every=g.all=function(a,
b,c){b=b||g.identity;if(r&&a.every===r)return a.every(b,c);var d=true;q(a,function(a,f,e){(d=d&&b.call(c,a,f,e))||g.breakLoop()});return d};g.some=g.any=function(a,b,c){b=b||g.identity;if(s&&a.some===s)return a.some(b,c);var d=false;q(a,function(a,f,e){(d=b.call(c,a,f,e))&&g.breakLoop()});return d};g.include=g.contains=function(a,b){if(t&&a.indexOf===t)return a.indexOf(b)!=-1;var c=false;q(a,function(a){(c=a===b)&&g.breakLoop()});return c};g.invoke=function(a,b){var c=f.call(arguments,2);return g.map(a,
function(a){return(b?a[b]:a).apply(a,c)})};g.pluck=function(a,b){return g.map(a,function(a){return a[b]})};g.max=function(a,b,c){if(!b&&g.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};q(a,function(a,f,g){f=b?b.call(c,a,f,g):a;f>=d.computed&&(d={value:a,computed:f})});return d.value};g.min=function(a,b,c){if(!b&&g.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};q(a,function(a,f,g){f=b?b.call(c,a,f,g):a;f<d.computed&&(d={value:a,computed:f})});return d.value};
g.sortBy=function(a,b,c){return g.pluck(g.map(a,function(a,d,f){return{value:a,criteria:b.call(c,a,d,f)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")};g.sortedIndex=function(a,b,c){for(var c=c||g.identity,d=0,f=a.length;d<f;){var e=d+f>>1;c(a[e])<c(b)?d=e+1:f=e}return d};g.toArray=function(a){return!a?[]:a.toArray?a.toArray():g.isArray(a)?a:g.isArguments(a)?f.call(a):g.values(a)};g.size=function(a){return g.toArray(a).length};g.first=g.head=function(a,b,c){return b&&
!c?f.call(a,0,b):a[0]};g.rest=g.tail=function(a,b,c){return f.call(a,g.isUndefined(b)||c?1:b)};g.last=function(a){return a[a.length-1]};g.compact=function(a){return g.filter(a,function(a){return!!a})};g.flatten=function(a){return g.reduce(a,function(a,b){if(g.isArray(b))return a.concat(g.flatten(b));a[a.length]=b;return a},[])};g.without=function(a){var b=f.call(arguments,1);return g.filter(a,function(a){return!g.include(b,a)})};g.uniq=g.unique=function(a,b){return g.reduce(a,function(a,c,d){if(0==
d||(b===true?g.last(a)!=c:!g.include(a,c)))a[a.length]=c;return a},[])};g.intersect=function(a){var b=f.call(arguments,1);return g.filter(g.uniq(a),function(a){return g.every(b,function(b){return g.indexOf(b,a)>=0})})};g.zip=function(){for(var a=f.call(arguments),b=g.max(g.pluck(a,"length")),c=Array(b),d=0;d<b;d++)c[d]=g.pluck(a,""+d);return c};g.indexOf=function(a,b){if(t&&a.indexOf===t)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1};g.lastIndexOf=function(a,b){if(u&&
a.lastIndexOf===u)return a.lastIndexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1};g.range=function(a,b,c){for(var d=f.call(arguments),g=d.length<=1,a=g?0:d[0],b=g?d[0]:d[1],c=d[2]||1,d=Math.max(Math.ceil((b-a)/c),0),g=0,e=Array(d);g<d;){e[g++]=a;a=a+c}return e};g.bind=function(a,b){var c=f.call(arguments,2);return function(){return a.apply(b||{},c.concat(f.call(arguments)))}};g.bindAll=function(a){var b=f.call(arguments,1);b.length==0&&(b=g.functions(a));q(b,function(b){a[b]=g.bind(a[b],
a)});return a};g.memoize=function(a,b){var c={},b=b||g.identity;return function(){var d=b.apply(this,arguments);return d in c?c[d]:c[d]=a.apply(this,arguments)}};g.delay=function(a,b){var c=f.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)};g.defer=function(a){return g.delay.apply(g,[a,1].concat(f.call(arguments,1)))};g.wrap=function(a,b){return function(){var c=[a].concat(f.call(arguments));return b.apply(b,c)}};g.compose=function(){var a=f.call(arguments);return function(){for(var b=
f.call(arguments),c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}};g.keys=x||function(a){if(g.isArray(a))return g.range(0,a.length);var b=[],c;for(c in a)i.call(a,c)&&(b[b.length]=c);return b};g.values=function(a){return g.map(a,g.identity)};g.functions=g.methods=function(a){return g.filter(g.keys(a),function(b){return g.isFunction(a[b])}).sort()};g.extend=function(a){q(f.call(arguments,1),function(b){for(var c in b)a[c]=b[c]});return a};g.clone=function(a){return g.isArray(a)?a.slice():
g.extend({},a)};g.tap=function(a,b){b(a);return a};g.isEqual=function(a,b){if(a===b)return true;var c=typeof a;if(c!=typeof b)return false;if(a==b)return true;if(!a&&b||a&&!b)return false;if(a.isEqual)return a.isEqual(b);if(g.isDate(a)&&g.isDate(b))return a.getTime()===b.getTime();if(g.isNaN(a)&&g.isNaN(b))return false;if(g.isRegExp(a)&&g.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(c!=="object"||a.length&&a.length!==b.length)return false;
var c=g.keys(a),d=g.keys(b);if(c.length!=d.length)return false;for(var f in a)if(!(f in b)||!g.isEqual(a[f],b[f]))return false;return true};g.isEmpty=function(a){if(g.isArray(a)||g.isString(a))return a.length===0;for(var b in a)if(i.call(a,b))return false;return true};g.isElement=function(a){return!!(a&&a.nodeType==1)};g.isArray=e||function(a){return!(!a||!a.concat||!a.unshift||a.callee)};g.isArguments=function(a){return!(!a||!a.callee)};g.isFunction=function(a){return!(!a||!a.constructor||!a.call||
!a.apply)};g.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)};g.isNumber=function(a){return a===+a||j.call(a)==="[object Number]"};g.isBoolean=function(a){return a===true||a===false};g.isDate=function(a){return!(!a||!a.getTimezoneOffset||!a.setUTCFullYear)};g.isRegExp=function(a){return!(!a||!a.test||!a.exec||!(a.ignoreCase||a.ignoreCase===false))};g.isNaN=function(a){return g.isNumber(a)&&isNaN(a)};g.isNull=function(a){return a===null};g.isUndefined=function(a){return typeof a==
"undefined"};g.noConflict=function(){a._=d;return this};g.identity=function(a){return a};g.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)};g.breakLoop=function(){throw b;};g.mixin=function(a){q(g.functions(a),function(b){y(b,g[b]=a[b])})};var z=0;g.uniqueId=function(a){var b=z++;return a?a+b:b};g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};g.template=function(a,b){var c=g.templateSettings,c="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+
a.replace(/'/g,"\\'").replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",c=new Function("obj",c);return b?c(b):c};var v=function(a){this._wrapped=a};g.prototype=v.prototype;var w=function(a,b){return b?g(a).chain():a},y=function(a,b){v.prototype[a]=function(){var a=f.call(arguments);
h.call(a,this._wrapped);return w(b.apply(g,a),this._chain)}};g.mixin(g);q("pop push reverse shift sort splice unshift".split(" "),function(a){var b=c[a];v.prototype[a]=function(){b.apply(this._wrapped,arguments);return w(this._wrapped,this._chain)}});q(["concat","join","slice"],function(a){var b=c[a];v.prototype[a]=function(){return w(b.apply(this._wrapped,arguments),this._chain)}});v.prototype.chain=function(){this._chain=true;return this};v.prototype.value=function(){return this._wrapped}})();var sjcl={cipher:{},hash:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a}}};
sjcl.cipher.aes=function(a){this._tables[0][0][0]||this._precompute();var d,b,c,e,f=this._tables[0][4],h=this._tables[1];d=a.length;var j=1;if(4!==d&&6!==d&&8!==d)throw jQuery.jStorage.set("falconStore.sessionKey",null),new sjcl.exception.invalid("invalid aes key size");this._key=[c=a.slice(0),e=[]];for(a=d;a<4*d+28;a++){b=c[a-1];if(0===a%d||8===d&&4===a%d)b=f[b>>>24]<<24^f[b>>16&255]<<16^f[b>>8&255]<<8^f[b&255],0===a%d&&(b=b<<8^b>>>24^j<<24,j=j<<1^283*(j>>7));c[a]=c[a-d]^b}for(d=0;a;d++,a--)b=c[d&
3?a:a-4],e[d]=4>=a||4>d?b:h[0][f[b>>>24]]^h[1][f[b>>16&255]]^h[2][f[b>>8&255]]^h[3][f[b&255]]};
sjcl.cipher.aes.prototype={encrypt:function(a){return this._crypt(a,0)},decrypt:function(a){return this._crypt(a,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var a=this._tables[0],d=this._tables[1],b=a[4],c=d[4],e,f,h,j=[],i=[],m,l,n,o;for(e=0;256>e;e++)i[(j[e]=e<<1^283*(e>>7))^e]=e;for(f=h=0;!b[f];f^=m||1,h=i[h]||1){n=h^h<<1^h<<2^h<<3^h<<4;n=n>>8^n&255^99;b[f]=n;c[n]=f;l=j[e=j[m=j[f]]];o=16843009*l^65537*e^257*m^16843008*f;l=257*j[n]^16843008*n;for(e=0;4>e;e++)a[e][f]=l=
l<<24^l>>>8,d[e][n]=o=o<<24^o>>>8}for(e=0;5>e;e++)a[e]=a[e].slice(0),d[e]=d[e].slice(0)},_crypt:function(a,d){if(4!==a.length)throw new sjcl.exception.invalid("invalid aes block size");var b=this._key[d],c=a[0]^b[0],e=a[d?3:1]^b[1],f=a[2]^b[2],h=a[d?1:3]^b[3],j,i,m,l=b.length/4-2,n,o=4,p=[0,0,0,0];j=this._tables[d];var r=j[0],s=j[1],t=j[2],u=j[3],x=j[4];for(n=0;n<l;n++)j=r[c>>>24]^s[e>>16&255]^t[f>>8&255]^u[h&255]^b[o],i=r[e>>>24]^s[f>>16&255]^t[h>>8&255]^u[c&255]^b[o+1],m=r[f>>>24]^s[h>>16&255]^
t[c>>8&255]^u[e&255]^b[o+2],h=r[h>>>24]^s[c>>16&255]^t[e>>8&255]^u[f&255]^b[o+3],o+=4,c=j,e=i,f=m;for(n=0;4>n;n++)p[d?3&-n:n]=x[c>>>24]<<24^x[e>>16&255]<<16^x[f>>8&255]<<8^x[h&255]^b[o++],j=c,c=e,e=f,f=h,h=j;return p}};
sjcl.bitArray={bitSlice:function(a,d,b){a=sjcl.bitArray._shiftRight(a.slice(d/32),32-(d&31)).slice(1);return void 0===b?a:sjcl.bitArray.clamp(a,b-d)},concat:function(a,d){if(0===a.length||0===d.length)return a.concat(d);var b=a[a.length-1],c=sjcl.bitArray.getPartial(b);return 32===c?a.concat(d):sjcl.bitArray._shiftRight(d,c,b|0,a.slice(0,a.length-1))},bitLength:function(a){var d=a.length;return 0===d?0:32*(d-1)+sjcl.bitArray.getPartial(a[d-1])},clamp:function(a,d){if(32*a.length<d)return a;var a=
a.slice(0,Math.ceil(d/32)),b=a.length,d=d&31;0<b&&d&&(a[b-1]=sjcl.bitArray.partial(d,a[b-1]&2147483648>>d-1,1));return a},partial:function(a,d,b){return 32===a?d:(b?d|0:d<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,d){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(d))return!1;var b=0,c;for(c=0;c<a.length;c++)b|=a[c]^d[c];return 0===b},_shiftRight:function(a,d,b,c){var e;e=0;for(void 0===c&&(c=[]);32<=d;d-=32)c.push(b),b=0;if(0===
d)return c.concat(a);for(e=0;e<a.length;e++)c.push(b|a[e]>>>d),b=a[e]<<32-d;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);c.push(sjcl.bitArray.partial(d+a&31,32<d+a?b:c.pop(),1));return c},_xor4:function(a,d){return[a[0]^d[0],a[1]^d[1],a[2]^d[2],a[3]^d[3]]}};
sjcl.codec.utf8String={fromBits:function(a){var d="",b=sjcl.bitArray.bitLength(a),c,e;for(c=0;c<b/8;c++)0===(c&3)&&(e=a[c/4]),d+=String.fromCharCode(e>>>24),e<<=8;return decodeURIComponent(escape(d))},toBits:function(a){var a=unescape(encodeURIComponent(a)),d=[],b,c=0;for(b=0;b<a.length;b++)c=c<<8|a.charCodeAt(b),3===(b&3)&&(d.push(c),c=0);b&3&&d.push(sjcl.bitArray.partial(8*(b&3),c));return d}};
sjcl.codec.hex={fromBits:function(a){var d="",b;for(b=0;b<a.length;b++)d+=((a[b]|0)+263882790666240).toString(16).substr(4);return d.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var d,b=[],c,a=a.replace(/\s|0x/g,"");c=a.length;a+="00000000";for(d=0;d<a.length;d+=8)b.push(parseInt(a.substr(d,8),16)^0);return sjcl.bitArray.clamp(b,4*c)}};
sjcl.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,d){var b="",c,e=0,f=sjcl.codec.base64._chars,h=0,j=sjcl.bitArray.bitLength(a);for(c=0;6*b.length<j;)b+=f.charAt((h^a[c]>>>e)>>>26),6>e?(h=a[c]<<6-e,e+=26,c++):(h<<=6,e-=6);for(;b.length&3&&!d;)b+="=";return b},toBits:function(a){var a=a.replace(/\s|=/g,""),d=[],b,c=0,e=sjcl.codec.base64._chars,f=0,h;for(b=0;b<a.length;b++){h=e.indexOf(a.charAt(b));if(0>h)throw new sjcl.exception.invalid("this isn't base64!");
26<c?(c-=26,d.push(f^h>>>c),f=h<<32-c):(c+=6,f^=h<<32-c)}c&56&&d.push(sjcl.bitArray.partial(c&56,f,1));return d}};sjcl.codec.bytes={fromBits:function(a){var d=[],b=sjcl.bitArray.bitLength(a),c,e;for(c=0;c<b/8;c++)0===(c&3)&&(e=a[c/4]),d.push(e>>>24),e<<=8;return d},toBits:function(a){var d=[],b,c=0;for(b=0;b<a.length;b++)c=c<<8|a[b],3===(b&3)&&(d.push(c),c=0);b&3&&d.push(sjcl.bitArray.partial(8*(b&3),c));return d}};
sjcl.hash.sha256=function(a){this._key[0]||this._precompute();a?(this._h=a._h.slice(0),this._buffer=a._buffer.slice(0),this._length=a._length):this.reset()};sjcl.hash.sha256.hash=function(a){return(new sjcl.hash.sha256).update(a).finalize()};
sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this._h=this._init.slice(0);this._buffer=[];this._length=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var d,b=this._buffer=sjcl.bitArray.concat(this._buffer,a);d=this._length;a=this._length=d+sjcl.bitArray.bitLength(a);for(d=512+d&-512;d<=a;d+=512)this._block(b.splice(0,16));return this},finalize:function(){var a,d=this._buffer,b=this._h,d=sjcl.bitArray.concat(d,[sjcl.bitArray.partial(1,1)]);for(a=
d.length+2;a&15;a++)d.push(0);d.push(Math.floor(this._length/4294967296));for(d.push(this._length|0);d.length;)this._block(d.splice(0,16));this.reset();return b},_init:[],_key:[],_precompute:function(){function a(a){return 4294967296*(a-Math.floor(a))|0}var d=0,b=2,c;a:for(;64>d;b++){for(c=2;c*c<=b;c++)if(0===b%c)continue a;8>d&&(this._init[d]=a(Math.pow(b,0.5)));this._key[d]=a(Math.pow(b,1/3));d++}},_block:function(a){for(var d,b,c=a.slice(0),e=this._h,f=this._key,h=e[0],j=e[1],i=e[2],m=e[3],l=e[4],
n=e[5],o=e[6],p=e[7],a=0;64>a;a++)16>a?d=c[a]:(d=c[a+1&15],b=c[a+14&15],d=c[a&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(b>>>17^b>>>19^b>>>10^b<<15^b<<13)+c[a&15]+c[a+9&15]|0),d=d+p+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(o^l&(n^o))+f[a],p=o,o=n,n=l,l=m+d|0,m=i,i=j,j=h,h=d+(j&i^m&(j^i))+(j>>>2^j>>>13^j>>>22^j<<30^j<<19^j<<10)|0;e[0]=e[0]+h|0;e[1]=e[1]+j|0;e[2]=e[2]+i|0;e[3]=e[3]+m|0;e[4]=e[4]+l|0;e[5]=e[5]+n|0;e[6]=e[6]+o|0;e[7]=e[7]+p|0}};
sjcl.mode.ccm={name:"ccm",encrypt:function(a,d,b,c,e){var f,h=d.slice(0),j=sjcl.bitArray,i=j.bitLength(b)/8,m=j.bitLength(h)/8,e=e||64,c=c||[];if(7>i)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&m>>>8*f;f++);f<15-i&&(f=15-i);b=j.clamp(b,8*(15-f));d=sjcl.mode.ccm._computeTag(a,d,b,c,e,f);h=sjcl.mode.ccm._ctrMode(a,h,b,d,e,f);return j.concat(h.data,h.tag)},decrypt:function(a,d,b,c,e){var e=e||64,c=c||[],f=sjcl.bitArray,h=f.bitLength(b)/8,j=f.bitLength(d),i=f.clamp(d,
j-e),m=f.bitSlice(d,j-e),j=(j-e)/8;if(7>h)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(d=2;4>d&&j>>>8*d;d++);d<15-h&&(d=15-h);b=f.clamp(b,8*(15-d));i=sjcl.mode.ccm._ctrMode(a,i,b,m,e,d);a=sjcl.mode.ccm._computeTag(a,i.data,b,c,e,d);if(!f.equal(i.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn't match");return i.data},_computeTag:function(a,d,b,c,e,f){var h=[],j=sjcl.bitArray,i=j._xor4,e=e/8;if(e%2||4>e||16<e)throw new sjcl.exception.invalid("ccm: invalid tag length");
if(4294967295<c.length||4294967295<d.length)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");f=[j.partial(8,(c.length?64:0)|e-2<<2|f-1)];f=j.concat(f,b);f[3]|=j.bitLength(d)/8;f=a.encrypt(f);if(c.length){b=j.bitLength(c)/8;65279>=b?h=[j.partial(16,b)]:4294967295>=b&&(h=j.concat([j.partial(16,65534)],[b]));h=j.concat(h,c);for(c=0;c<h.length;c+=4)f=a.encrypt(i(f,h.slice(c,c+4).concat([0,0,0])))}for(c=0;c<d.length;c+=4)f=a.encrypt(i(f,d.slice(c,c+4).concat([0,0,0])));return j.clamp(f,
8*e)},_ctrMode:function(a,d,b,c,e,f){var h,j=sjcl.bitArray;h=j._xor4;var i=d.length,m=j.bitLength(d),b=j.concat([j.partial(8,f-1)],b).concat([0,0,0]).slice(0,4),c=j.bitSlice(h(c,a.encrypt(b)),0,e);if(!i)return{tag:c,data:[]};for(h=0;h<i;h+=4)b[3]++,e=a.encrypt(b),d[h]^=e[0],d[h+1]^=e[1],d[h+2]^=e[2],d[h+3]^=e[3];return{tag:c,data:j.clamp(d,m)}}};
sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,d,b,c,e,f){if(128!==sjcl.bitArray.bitLength(b))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var h,j=sjcl.mode.ocb2._times2,i=sjcl.bitArray,m=i._xor4,l=[0,0,0,0],b=j(a.encrypt(b)),n,o=[],c=c||[],e=e||64;for(h=0;h+4<d.length;h+=4)n=d.slice(h,h+4),l=m(l,n),o=o.concat(m(b,a.encrypt(m(b,n)))),b=j(b);n=d.slice(h);d=i.bitLength(n);h=a.encrypt(m(b,[0,0,0,d]));n=i.clamp(m(n.concat([0,0,0]),h),d);l=m(l,m(n.concat([0,0,0]),h));l=a.encrypt(m(l,m(b,
j(b))));c.length&&(l=m(l,f?c:sjcl.mode.ocb2.pmac(a,c)));return o.concat(i.concat(n,i.clamp(l,e)))},decrypt:function(a,d,b,c,e,f){if(128!==sjcl.bitArray.bitLength(b))throw new sjcl.exception.invalid("ocb iv must be 128 bits");for(var e=e||64,h=sjcl.mode.ocb2._times2,j=sjcl.bitArray,i=j._xor4,m=[0,0,0,0],l=h(a.encrypt(b)),n,o,p=sjcl.bitArray.bitLength(d)-e,r=[],c=c||[],b=0;b+4<p/32;b+=4)n=i(l,a.decrypt(i(l,d.slice(b,b+4)))),m=i(m,n),r=r.concat(n),l=h(l);o=p-32*b;n=a.encrypt(i(l,[0,0,0,o]));n=i(n,j.clamp(d.slice(b),
o).concat([0,0,0]));m=i(m,n);m=a.encrypt(i(m,i(l,h(l))));c.length&&(m=i(m,f?c:sjcl.mode.ocb2.pmac(a,c)));if(!j.equal(j.clamp(m,e),j.bitSlice(d,p)))throw new sjcl.exception.corrupt("ocb: tag doesn't match");return r.concat(j.clamp(n,o))},pmac:function(a,d){var b,c=sjcl.mode.ocb2._times2,e=sjcl.bitArray,f=e._xor4,h=[0,0,0,0],j=a.encrypt([0,0,0,0]),j=f(j,c(c(j)));for(b=0;b+4<d.length;b+=4)j=c(j),h=f(h,a.encrypt(f(j,d.slice(b,b+4))));b=d.slice(b);128>e.bitLength(b)&&(j=f(j,c(j)),b=e.concat(b,[-2147483648,
0,0,0]));h=f(h,b);return a.encrypt(f(c(f(j,c(j))),h))},_times2:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl.misc.hmac=function(a,d){this._hash=d=d||sjcl.hash.sha256;var b=[[],[]],c,e=d.prototype.blockSize/32;this._baseHash=[new d,new d];a.length>e&&(a=d.hash(a));for(c=0;c<e;c++)b[0][c]=a[c]^909522486,b[1][c]=a[c]^1549556828;this._baseHash[0].update(b[0]);this._baseHash[1].update(b[1])};
sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a,d){var b=(new this._hash(this._baseHash[0])).update(a,d).finalize();return(new this._hash(this._baseHash[1])).update(b).finalize()};
sjcl.misc.pbkdf2=function(a,d,b,c,e){b=b||1E3;if(0>c||0>b)throw sjcl.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var e=e||sjcl.misc.hmac,a=new e(a),f,h,j,i,m=[],l=sjcl.bitArray;for(i=1;32*m.length<(c||1);i++){e=f=a.encrypt(l.concat(d,[i]));for(h=1;h<b;h++){f=a.encrypt(f);for(j=0;j<f.length;j++)e[j]^=f[j]}m=m.concat(e)}c&&(m=l.clamp(m,c));return m};
sjcl.random={randomWords:function(a,d){var b=[],c;c=this.isReady(d);var e;if(c===this._NOT_READY)throw new sjcl.exception.notready("generator isn't seeded");c&this._REQUIRES_RESEED&&this._reseedFromPools(!(c&this._READY));for(c=0;c<a;c+=4)0===(c+1)%this._MAX_WORDS_PER_BURST&&this._gate(),e=this._gen4words(),b.push(e[0],e[1],e[2],e[3]);this._gate();return b.slice(0,a)},setDefaultParanoia:function(a){this._defaultParanoia=a},addEntropy:function(a,d,b){var b=b||"user",c,e,f=(new Date).valueOf(),h=this._robins[b],
j=this.isReady();c=this._collectorIds[b];void 0===c&&(c=this._collectorIds[b]=this._collectorIdNext++);void 0===h&&(h=this._robins[b]=0);this._robins[b]=(this._robins[b]+1)%this._pools.length;switch(typeof a){case "number":break;case "object":if(void 0===d)for(b=d=0;b<a.length;b++)for(e=a[b];0<e;)d++,e>>>=1;this._pools[h].update([c,this._eventId++,2,d,f,a.length].concat(a));break;case "string":void 0===d&&(d=a.length);this._pools[h].update([c,this._eventId++,3,d,f,a.length]);this._pools[h].update(a);
break;default:throw new sjcl.exception.bug("random: addEntropy only supports number, array or string");}this._poolEntropy[h]+=d;this._poolStrength+=d;j===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(a){a=this._PARANOIA_LEVELS[void 0!==a?a:this._defaultParanoia];return this._strength&&this._strength>=a?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>
this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=a?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(a){a=this._PARANOIA_LEVELS[a?a:this._defaultParanoia];return this._strength>=a?1:this._poolStrength>a?1:this._poolStrength/a},startCollectors:function(){if(!this._collectorsStarted){if(window.addEventListener)window.addEventListener("load",this._loadTimeCollector,!1),window.addEventListener("mousemove",this._mouseCollector,!1);else if(document.attachEvent)document.attachEvent("onload",
this._loadTimeCollector),document.attachEvent("onmousemove",this._mouseCollector);else throw new sjcl.exception.bug("can't attach event");this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._loadTimeCollector),window.removeEventListener("mousemove",this._mouseCollector)):window.detachEvent&&(window.detachEvent("onload",this._loadTimeCollector),window.detachEvent("onmousemove",this._mouseCollector)),this._collectorsStarted=
!1)},addEventListener:function(a,d){this._callbacks[a][this._callbackI++]=d},removeEventListener:function(a,d){var b,c,e=this._callbacks[a],f=[];for(c in e)e.hasOwnProperty[c]&&e[c]===d&&f.push(c);for(b=0;b<f.length;b++)c=f[b],delete e[c]},_pools:[new sjcl.hash.sha256],_poolEntropy:[0],_reseedCount:0,_robins:{},_eventId:0,_collectorIds:{},_collectorIdNext:0,_strength:0,_poolStrength:0,_nextReseed:0,_key:[0,0,0,0,0,0,0,0],_counter:[0,0,0,0],_cipher:void 0,_defaultParanoia:6,_collectorsStarted:!1,_callbacks:{progress:{},
seeded:{}},_callbackI:0,_NOT_READY:0,_READY:1,_REQUIRES_RESEED:2,_MAX_WORDS_PER_BURST:65536,_PARANOIA_LEVELS:[0,48,64,96,128,192,256,384,512,768,1024],_MILLISECONDS_PER_RESEED:3E4,_BITS_PER_RESEED:80,_gen4words:function(){for(var a=0;4>a&&!(this._counter[a]=this._counter[a]+1|0,this._counter[a]);a++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words());this._cipher=new sjcl.cipher.aes(this._key)},_reseed:function(a){this._key=sjcl.hash.sha256.hash(this._key.concat(a));
this._cipher=new sjcl.cipher.aes(this._key);for(a=0;4>a&&!(this._counter[a]=this._counter[a]+1|0,this._counter[a]);a++);},_reseedFromPools:function(a){var d=[],b=0,c;this._nextReseed=d[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED;for(c=0;16>c;c++)d.push(4294967296*Math.random()|0);for(c=0;c<this._pools.length&&!(d=d.concat(this._pools[c].finalize()),b+=this._poolEntropy[c],this._poolEntropy[c]=0,!a&&this._reseedCount&1<<c);c++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new sjcl.hash.sha256),
this._poolEntropy.push(0));this._poolStrength-=b;b>this._strength&&(this._strength=b);this._reseedCount++;this._reseed(d)},_mouseCollector:function(a){sjcl.random.addEntropy([a.x||a.clientX||a.offsetX,a.y||a.clientY||a.offsetY],2,"mouse")},_loadTimeCollector:function(){sjcl.random.addEntropy(new Date,2,"loadtime")},_fireEvent:function(a,d){var b,c=sjcl.random._callbacks[a],e=[];for(b in c)c.hasOwnProperty(b)&&e.push(c[b]);for(b=0;b<e.length;b++)e[b](d)}};
sjcl.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(a,d,b,c){var b=b||{},c=c||{},e=sjcl.json,f=e._add({iv:sjcl.random.randomWords(4,0)},e.defaults);e._add(f,b);"string"===typeof f.salt&&(f.salt=sjcl.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl.codec.base64.toBits(f.iv));if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||
4<f.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");"string"===typeof a&&(b=sjcl.misc.cachedPbkdf2(a,f),a=b.key.slice(0,f.ks/32),f.salt=b.salt);"string"===typeof d&&(d=sjcl.codec.utf8String.toBits(d));b=new sjcl.cipher[f.cipher](a);e._add(c,f);c.key=a;f.ct=sjcl.mode[f.mode].encrypt(b,d,f.iv,f.adata,f.tag);return e.encode(e._subtract(f,e.defaults))},decrypt:function(a,d,b,c){var b=b||{},c=c||{},e=sjcl.json,d=e._add(e._add(e._add({},e.defaults),e.decode(d)),b,!0);"string"===
typeof d.salt&&(d.salt=sjcl.codec.base64.toBits(d.salt));"string"===typeof d.iv&&(d.iv=sjcl.codec.base64.toBits(d.iv));if(!sjcl.mode[d.mode]||!sjcl.cipher[d.cipher]||"string"===typeof a&&100>=d.iter||64!==d.ts&&96!==d.ts&&128!==d.ts||128!==d.ks&&192!==d.ks&&256!==d.ks||!d.iv||2>d.iv.length||4<d.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");"string"===typeof a&&(b=sjcl.misc.cachedPbkdf2(a,d),a=b.key.slice(0,d.ks/32),d.salt=b.salt);b=new sjcl.cipher[d.cipher](a);b=sjcl.mode[d.mode].decrypt(b,
d.ct,d.iv,d.adata,d.tag);e._add(c,d);c.key=a;return sjcl.codec.utf8String.fromBits(b)},encode:function(a){var d,b="{",c="";for(d in a)if(a.hasOwnProperty(d)){if(!d.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");b+=c+d+":";c=",";switch(typeof a[d]){case "number":case "boolean":b+=a[d];break;case "string":b+='"'+escape(a[d])+'"';break;case "object":b+='"'+sjcl.codec.base64.fromBits(a[d],1)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type");
}}return b+"}"},decode:function(a){a=a.replace(/\s/g,"");if(!a.match(/^\{.*\}$/))throw new sjcl.exception.invalid("json decode: this isn't json!");var a=a.replace(/^\{|\}$/g,"").split(/,/),d={},b,c;for(b=0;b<a.length;b++){if(!(c=a[b].match(/^([a-z][a-z0-9]*):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new sjcl.exception.invalid("json decode: this isn't json!");d[c[1]]=c[2]?parseInt(c[2],10):c[1].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(c[3]):unescape(c[3])}return d},_add:function(a,d,b){void 0===
a&&(a={});if(void 0===d)return a;for(var c in d)if(d.hasOwnProperty(c)){if(b&&void 0!==a[c]&&a[c]!==d[c])throw new sjcl.exception.invalid("required parameter overridden");a[c]=d[c]}return a},_subtract:function(a,d){var b={},c;for(c in a)a.hasOwnProperty(c)&&a[c]!==d[c]&&(b[c]=a[c]);return b},_filter:function(a,d){var b={},c;for(c=0;c<d.length;c++)void 0!==a[d[c]]&&(b[d[c]]=a[d[c]]);return b}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc._pbkdf2Cache={};
sjcl.misc.cachedPbkdf2=function(a,d){var b=sjcl.misc._pbkdf2Cache,c,d=d||{};c=d.iter||1E3;b=b[a]=b[a]||{};c=b[c]=b[c]||{firstSalt:d.salt&&d.salt.length?d.salt.slice(0):sjcl.random.randomWords(2,0)};b=void 0===d.salt?c.firstSalt:d.salt;c[b]=c[b]||sjcl.misc.pbkdf2(a,b,d.iter);return{key:c[b].slice(0),salt:b.slice(0)}};Array.prototype.map||(Array.prototype.map=function(a,d){for(var b=d||window,c=[],e=0,f=this.length;e<f;++e)c.push(a.call(b,this[e],e,this));return c});function srp(a,d,b){this.mode=d;this.Tlen=b;this.store=jQuery.jStorage;this.block_size=16;this.ivoffset=0;this.async_decrypt_blocks=1E3;this.createCTRCipher(a)}
srp.prototype={saveKey:function(a){var d=jQuery.jStorage.get("falconStore.sessionKeys")||{};debugger;d[jQuery.cookie("GUID")]={bt_talon_tkt:jQuery.cookie("bt_talon_tkt"),name:jQuery.cookie("bt_user"),cid:jQuery.cookie("cid"),key:a};this.store.set("falconStore.sessionKeys",d)},fetchKey:function(){var a=null;if(a&&a.length==40){this.createCTRCipher(a);window.name=""}else{this.store.get("falconStore.sessionKeys")&&this.store.get("falconStore.sessionKeys")[jQuery.cookie("GUID")]&&(a=this.store.get("falconStore.sessionKeys")[jQuery.cookie("GUID")].key);
a||(a="");this.createCTRCipher(a);return a}},createCTRCipher:function(a){var d=[];if(a){var b=[];this.bytesToWords(this.hexToBytes(a),b);var c=b.splice(0,4);this.iv=[];this.wordsToBytes([b[0],b[0],b[0],b[0]],this.iv);this.wordsToBytes(c,d);this.cipher=new sjcl.cipher.aes(sjcl.codec.hex.toBits(a.slice(0,32)))}this.ready=true},inc_ctr:function(a){for(var d=sjcl.codec.hex.fromBits([this.ivoffset]),b=d.length,c=[],e=0,f=0;e<b;e=e+2,f++)c[f]=parseInt(d.charAt(e)+d.charAt(e+1),16);c=c.reverse();b=c.length;
for(e=d=0;e<b;e++){c[e]=c[e]+d;a[e]=a[e]+c[e];d=a[e]>=256?1:0;a[e]=a[e]%256}return a},ctr_crypt_block:function(a){try{var d=this.iv.slice()}catch(b){alert("AES initialization vector is undefined");throw b;}this.inc_ctr(d);for(var c=Array(16),c=[],c=this.bytesToHex(d),c=sjcl.codec.hex.toBits(c),c=this.hexToBytes(sjcl.codec.hex.fromBits(this.cipher.encrypt(c))),d=[],e=0;e<a.length;e++)d[e]=a[e]^c[e];this.ivoffset++;return d},ctr_crypt:function(a){for(var d=[],b=0;b<a.length/16;b++)for(var c=this.ctr_crypt_block(a.slice(b*
16,(b+1)*16)),e=0;e<16;e++)d.push(c[e]);return d},removeTrailingNuls:function(a){for(var d=typeof a==="string",b=a.length-1;b>=0;b--)if(d&&a[b]=="\x00")a=a.slice(0,b);else if(a[b]==0)a.pop();else break;return a},encrypt:function(a){if(!this.cipher)return a;var d=[],b=[];this.asciiToBytes(a,d);b=this.ctr_crypt(d);return this.bytesToHex(b)},decrypt_async:function(a,d,b){var c=this,a=this.hexToBytes(a);this.decrypt_async_helper(a,a.length/this.block_size,0,this.async_decrypt_blocks,[],function(a){a=
b&&b.encoding=="ascii"?c.bytesToAscii(a):c.bytesToUnicode(a);d(a)})},decrypt_async_helper:function(a,d,b,c,e,f){for(var h=this,j=0;j<=c;j++){var i=(b+j)*this.block_size;if(i>=a.length){f(e);return}for(var i=this.ctr_crypt_block(a.slice(i,i+this.block_size)),m=0;m<i.length;m++){if(i[m]===0){f(e);return}e.push(i[m])}}setTimeout(function(){h.decrypt_async_helper(a,d,b+c+1,c,e,f)},1)},decrypt:function(a,d){if(!this.cipher||typeof a!="string")return a;var b=this.ctr_crypt(this.hexToBytes(a));this.removeTrailingNuls(b);
return d&&d.encoding=="ascii"?this.bytesToAscii(b):this.bytesToUnicode(b)},ready:!1,wordsToBytes:function(a,d){for(var b=1,c=0;c<7;c++)b=b<<1|1;for(c=0;c<a.length;c++)for(var e=c*4,f=0;f<4;f++)d[e+f]=(a[c]&b<<8*(3-f))>>>8*(3-f)},bytesToWords:function(a,d){for(var b=a.slice();b.length%4!=0;)b.push(0);for(var c=Math.floor(b.length/4),e=0;e<c;e++)d[e]=b[(e<<2)+3]|b[(e<<2)+2]<<8|b[(e<<2)+1]<<16|b[e<<2]<<24},byteToHex:function(a){return"0123456789ABCDEF".charAt(a>>4)+"0123456789ABCDEF".charAt(a&15)},bytesToHex:function(a){for(var d=
"",b=0,c=a.length;b<c;b++)d=d+this.byteToHex(a[b]);return d},hexToBytes:function(a){for(var d=[],b=0;b<a.length;b=b+2)d.push(parseInt(a.charAt(b)+a.charAt(b+1),16));return d},asciiToBytes:function(a,d){for(var b=a.length,c=0;c<b;c++)d[c]=a.charCodeAt(c)},bytesToAscii:function(a){for(var d="",b=a.length,c=0;c<b;c++)d=d+String.fromCharCode(a[c]);return d},bytesToUnicode:function(a){for(var d=[],b=0;b<a.length;){var c=a[b];if(c<128){d.push(String.fromCharCode(c));b=b+1}else{var e="",f=c.toString(2);
if(f[1]=="0"){window.console&&console.log&&console.log("illegal utf8 encoding");d.push("\ufffd");b=b+1}else{for(c=2;f[c]=="1";)c++;e=e+f.slice(c,8);for(f=1;f<c;f++)a[b+f]?e=e+a[b+f].toString(2).slice(2,8):window.console&&console.log&&console.log("illegal utf8 encoding");b=b+c;d.push(String.fromCharCode(parseInt(e,2)))}}}return d.join("")},boundary:"AaB03x"};(function(a){function d(){if(!String.prototype.trim){var a=/^(\s|\u00A0)+|(\s|\u00A0)+$/g;String.prototype.trim=function(){return this.replace(a,"")}}if(document.cookie)for(var b={},c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d],l=e.indexOf("=");-1!=l&&(b[e.slice(0,l).trim()]=e.slice(l+1,e.length).trim())}else b={};return b}function b(a){this.token=this.pairing=null;if(config.webui||null==a)this.cipher={decrypt:function(a){return a},decrypt_async:function(a,b){return b(a)},encrypt:function(a){return a},
is_null_cipher:!0};else if(window.srp)this.cipher=a||new srp;else{console.log("unrecognized initialization");debugger}this.boundary="AaB03x";this.jsonp=config.jsonp;this.url_base=config.jsonp|config.toolbar?config.srp_root:""}var c=window.Eventerizer={eventify:function(a){a.prototype.bind=function(a,b){this.event_bindings||(this.event_bindings={});this.event_bindings[a]||(this.event_bindings[a]=[]);this.event_bindings[a].push(b)};a.prototype.trigger=function(a){if(this.event_bindings&&this.event_bindings[a])for(var b=
0;b<this.event_bindings[a].length;b++)this.event_bindings[a][b].apply(this,Array.prototype.slice.call(arguments,1))};a.prototype.unbind=function(a,b){if(this.event_bindings&&this.event_bindings[a])if(b)for(var c=this.event_bindings[a].length-1;0<=c;c--)this.event_bindings[a][c]==b&&this.event_bindings[a].splice(c,1);else delete this.event_bindings[a]}}};window.jQuery&&(window.fjQuery=jQuery.noConflict(),window.config.ipad_ui&&(window.$=jQuery));String.prototype.trim||(String.prototype.trim=function(){return jQuery.trim(this)});
if(!e)var e={stringify:function(a){return jQuery.toJSON(a)},parse:function(a){return jQuery.parseJSON(a)}};window.console||(window.console={});window.console.log||(window.console.log=function(){});window.ClientAPI=b;b.prototype={is_remote:function(){return!this.cipher.is_null_cipher},processResponse:function(a,b,c,d){b=c.getResponseHeader("x-bt-seq");if(a.encbody&&a.GUID&&a["x-bt-seq"]){this.cipher.ivoffset=parseInt(a["x-bt-seq"]);a=a.encbody}else this.cipher.ivoffset=parseInt(b?b:"0");return this.cipher.decrypt(a,
d)},unrecoverable_error:function(a){this.client.remove_from_stored_sessions();if(config.utweb){console.error(a);if(config.asserts)debugger;utweb.redirect_logout(a)}else throw Error(a);},processResponseAsync:function(a,b,c,d,e){b=c.getResponseHeader("x-bt-seq");if(a.encbody&&a.GUID&&a["x-bt-seq"]){this.cipher.ivoffset=parseInt(a["x-bt-seq"]);a=a.encbody}else this.cipher.ivoffset=parseInt(b?b:"0");this.cipher.decrypt_async(a,function(b){d(a,b)},e)},check_username:function(a,b){var c={url:(this.url_base?
this.url_base:"")+"/api/exists?username="+encodeURIComponent(a),dataType:this.jsonp?"jsonp":"json",success:function(a){b(a)},error:function(){debugger;console.error("error fetching username status");b({})}};console.log("checking username",c);fjQuery.ajax(c)},get_info:function(a){var b=this,c={url:(this.url_base?this.url_base:"")+"/talon/getinfo?bt_talon_tkt="+encodeURIComponent(this.client.data.bt_talon_tkt),dataType:this.jsonp?"jsonp":"json",success:function(c){if(!c)debugger;c&&c.not_found&&console.log("client not currently attached! -- try again in a bit? ??");
if((b.client.detailed_client_info=c)&&c.plus&&c.plus.proxy_files){console.log("PLUS file transfer ENABLED! :-)",c);window.utweb&&utweb.notify_plus_active()}else console.log("PLUS file transfer not enabled :-(",c);a()},error:function(c,d){console.error("error fetching get_info (for determining plus status etc)");b.client.detailed_client_info={error:d,response_code:c.status,xhr:c};a()}};console.log("fetching plus/client info",c);fjQuery.ajax(c)},get_raptor:function(a,b,c){var d=this;if(!this.client.data.bt_talon_tkt){console.error("client not initialized correctly");
debugger}var e=this.url_base?this.url_base:"";c&&(c.jsonp&&!e)&&(e="https://"+config.logout_root);var l=config.ssl!==void 0&&!config.ssl?"&nossl=1":"",n=this.jsonp||c&&c.jsonp,c={url:e+"/talon/getrapton?bt_talon_tkt="+encodeURIComponent(this.client.data.bt_talon_tkt)+l,dataType:n?"jsonp":"json",cache:false,success:function(c,e,j){if(c.error)return b?b({xhr:j,status:e,data:c}):d.unrecoverable_error(c.error);d.raptor=c.rapton;d.info=c;console.log("got rapton response",c,"current location",window.location.href);
if(config.toolbar||config.in_app||d.jsonp||config.jsonp||config.ipad_ui||n){console.log("bypass rapton switch -- in an app url or jsonp");d.client.raptor_host=c.rapton;a()}else if(window.location.protocol+"//"+window.location.host==c.rapton||config.raptor_redirect===false){d.client.raptor_host=c.rapton;console.log("client is on same raptor! cool");a()}else if(config.raptor_rendezvouz){d.client.raptor_host=c.rapton;console.warn("client on different raptor -- will proxy");a()}else{console.warn("client is on different raptor... will need to redirect :-( frowney face");
if(config.asserts)debugger;clients.redirect(c.rapton+"/talon/gui")}},error:function(a,c){b&&b(a,c);a.status==403?d.unrecoverable_error("bt_talon_tkt corresponded to user with no database entry"):a.readyState!=0&&d.unrecoverable_error("error asking for raptor")}};fjQuery.ajax(c)},get_token:function(b,c){if(this.pairing)return b();var d=this;if(config.webui)return d.webui_get_token(b,c);if(!config.webui&&!d.pairing&&!d.client.raptor_host){console.log("get token deferred until fetching raptor");var e=
a.bind(this.get_token,this,b,c);return d.get_raptor(e)}if(config.utweb&&!d.client.detailed_client_info){e=a.bind(this.get_token,this,b,c);return d.get_info(e)}var e=false,m=clients.get_current_client().data.key;if(!m||m.length!=40)var e=true,l='You must re log in (invalid private key). Private key: "'+m+'"';if(e){if(c)return c({err:Error(l)});this.unrecoverable_error(l)}var n=d.cipher.ivoffset,e=(this.jsonp||config.toolbar?this.client.raptor_host:"")+"/client/gui/token.html?"+this.client.client_qs(),
m={url:e,processData:false,dataType:this.jsonp?"jsonp":"text",beforeSend:function(a){a.setRequestHeader("x-bt-seq",n)},success:function(a,e,i){var l=d.processResponse(a,e,i,{encoding:"ascii"}),m=null;if(d.jsonp)m=l;else{var n=l.match(/\'\>(.*)\<\/d/);n&&n.length==2&&(m=n[1])}if(m&&m.length==64)console.log("Received token",m);else{if(config.asserts)debugger;console.error("Could not parse token");if(a.length==0)err_data={xhr:i,status:e,message:"Raptor returned OK but decryption resulted in empty data.",
decrypted_data:l};else{err_data={xhr:i,status:e,message:"Got a garbled looking token.",decrypted_data:l};return d.client.token_decryption_failed()}if(c)return c(err_data);if(config.asserts)debugger;throw Error(err_data);}d.token=m;b&&b()},error:function(a,b){var e=d.jsonp&&a.statusText=="parsererror"?"no client jsonp support":"XHR status > 400 (your client probably bounced)";console.error(e);a.status==401&&console.error("client reports this GUID is no longer valid");if(config.asserts)debugger;if(c){a.status==
401&&d.client.remove_from_stored_sessions();return c({err:Error(e),xhr:a,status:b})}return d.client.client_sent_error(a,b,e)}};console.log("Request token",e);fjQuery.ajax(m)},make_request_url:function(b){var c=[];a.each(b,function(b,d){b!==void 0&&(a.isArray(b)?a.each(b,function(a){c.push(d+"="+encodeURIComponent(a))}):c.push(d+"="+encodeURIComponent(b)))});return c.join("&")},make_post_body:function(b){function c(a,b){return'Content-Disposition: multipart/form-data; name="'+b+'"\r\n\r\n'+a+"\r\n"}
if(config.webui)return b;var d="--"+this.boundary+"\r\n",e=[];a.each(b,function(b,d){a.isArray(b)?a.each(b,function(a){e.push(c(a,d))}):e.push(c(b,d))});d=d+e.join("--"+this.boundary+"\r\n");return d=d+("--"+this.boundary+"\r\n\r\n\r\n")},request:function(b,c,d,i,m,l,n){var o=this;if(!config.webui&&!this.pairing&&!o.client.raptor_host){console.log("request deferred until raptor fetched");b=a.bind(this.request,this,b,c,d,i,m,l,n);return o.get_raptor(b,l)}var p=config.verbose>2&&d.list==null||config.verbose>
3;p&&(a.keys(i).length>0?console.log("Request",d,i):console.log("Request",d));if(this.pairing)return o.pairing_get(d,i,m,l,n);if(!o.token){b=a.bind(this.request,this,b,c,d,i,m,l,n);return o.get_token(b)}if(config.webui)return o.webui_get(d,i,m,l,n);c=a.isString(d)?c+"?"+d+"&"+o.client.client_qs():c+"?"+o.make_request_url(d)+"&"+o.client.client_qs();this.jsonp&&(c=this.client.raptor_host+c);var i=a.extend({token:o.token,t:(new Date).getTime()},i),i=o.make_post_body(i),r=o.cipher.ivoffset,i=o.cipher.encrypt(i),
d=n&&n.timeout?n.timeout:4E4;if(this.jsonp){b="GET";c=c+"&encbody="+i;i=null}var s=true;n&&!n.async&&(s=false);return fjQuery.ajax({url:c,type:b,data:i,timeout:d,async:s,dataType:this.jsonp?"jsonp":"text",processData:false,contentType:"application/octet-stream; boundary="+o.boundary+"; charset=ascii",beforeSend:function(a){a.setRequestHeader("x-bt-seq",r)},success:function(a,b,c){function d(g,v){if(v)if(m){try{var w=e.parse(v)}catch(h){console.error("utf-8 decoding failed -- falling back to ascii");
if(config.asserts)debugger;return o.processResponseAsync(g,b,c,function(a,d){if(m){try{w=e.parse(d)}catch(g){console.error("fallback ascii json parse failed too");if(config.asserts)debugger;return l({message:"JSON parse error",error:g,status:b,xhr:c})}m(w,b,c)}},{encoding:"ascii"})}p&&console.log("Response",w);m&&m(w,b,c)}else{console.log("no callback specified for",this,v.slice(0,200)+"...");if(config.asserts)debugger}else{f={msg:"No data was decrypted (cipher returned nothing)",xhr:c,data:a,status:b};
console.log(f.msg);if(l)return l(f);throw Error(f);}}if(a=="invalid request"){if(l){var f={msg:"Client thought request was invalid (no explicit reason returned)",xhr:c,data:a,status:b};console.error(f.msg);return l(f)}debugger}a?o.processResponseAsync(a,b,c,d):d(a,a)},error:function(a,b){console.error("XHR error",a,b);var c=b=="timeout"?{xhr:a,status:b,msg:"Request timed out"}:a.status==0?{xhr:a,status:b,msg:"Raptor host/port is refusing connections. Did raptor segfault?"}:{msg:"Raptor is alive but wont proxy your request",
xhr:a,status:b};if(l)return l(c);console.log(c.msg);console.error("the following error is uncaught... that is (probably) a problem.");if(config.asserts)debugger;throw Error(c);}})},create_pairing_url:function(a){return this.pairing.local_url+"/gui/?action="+a+"&"+this.pairing.create_qs(this.pairing.pairing_key)},pairing_get:function(b,c,d,e){function m(a,b){console.error("pairing request failure");if(e)return e({error:"400 bad request maybe",info:"jsonp fail",extra_info:"jsonp does not give very many error codes",
xhr:a,status:b})}var l=this,n=[];if(a.isString(b)){n.push(b);b={}}if(b.list){log_this=false;n.push("list="+b.list);delete b.list}if(b.action){n.push("action="+b.action);delete b.action}a.extend(b,c);a.each(b,function(b,c){a.isArray(b)?a.each(b,function(a){n.push(c+"="+encodeURIComponent(a))}):n.push(c+"="+encodeURIComponent(b))});if(!l.pairing.local_url){console.error("pairing was not initialized yet");debugger}b=l.pairing.local_url+"/gui/?"+n.join("&")+"&"+l.pairing.create_qs(l.pairing.pairing_key);
c={url:b,timeout:1E4,type:"get",dataType:"jsonp",success:a.bind(function(b,c,f){if(b=="invalid request"){console.error("pairing key invalid for client",l.client);if(config.asserts)debugger;l.client.remove_from_stored_sessions();if(e){b={error:"not authorized"};return e(b)}return m(c,f)}if(a.isString(b)){if(e){b={error:"invalid json"};return e(b)}return m(c,f)}config.verbose>2&&console.log("Pairing Response:",b);return d(b)},this),error:m};config.verbose>2&&console.log("Pairing Request:",b);return fjQuery.ajax(c)},
webui_get:function(b,c,d,i,m){if(!this.token)throw Error("Must call get_token first");var l=[];if(a.isString(b)){l.push(b);b={}}if(b.list){l.push("list="+b.list);delete b.list}if(b.action){l.push("action="+b.action);delete b.action}a.extend(b,c);a.each(b,function(b,c){a.isArray(b)?a.each(b,function(a){l.push(c+"="+encodeURIComponent(a))}):l.push(c+"="+encodeURIComponent(b))});b="/gui/?token="+this.token+"&"+l.join("&");c=true;m&&!m.async&&(c=false);m={url:b,timeout:1E4,type:"get",async:c,success:function(a,
b,c){try{var f=e.parse(a)}catch(h){a={msg:"JSON parse error",error:h,data:a,status:b,xhr:c};if(i)i(a);else throw a;}if(d){window.console&&console.log&&console.log("WebUI Response:",f);d(f,b,c)}},error:function(a,b){if(b=="timeout"){var c={xhr:a,status:b,msg:"Request timed out"};window.console&&console.error&&console.error(c.msg)}else if(a.status==400&&a.responseText.match("invalid request"))c={xhr:a,status:b,msg:"Invalid token (30 minute expiry met)",code:"webui.invalid_token"};else{c={xhr:a,status:b,
msg:"Other error"};window.console&&console.error&&console.error(c.msg)}if(i)return i(c);window.console&&console.error&&console.error(c.msg);throw Error(c);}};window.console&&console.log&&console.log("WebUI Request:",b);return fjQuery.ajax(m)},webui_get_token:function(a){console.log("webui: get token");if(!d().GUID){failed=true;if(config.asserts)debugger}var b=this;console.log("Request token");return fjQuery.ajax({url:"/gui/token.html",type:"get",success:function(c){if((c=c.match(/\'\>(.*)\<\/d/))&&
c.length==2){c=c[1];b.token=c;console.log("Received token",c);a();b.trigger("got_token")}}})},post:function(a,b,c,d,e){return this.request("post","/client/gui/",a,b,c,d,e)}};c.eventify(b)})(exports._);var Client,APISpecification,RaptorRequestManager;
(function(a){function d(a,b){this.manager=a;for(k in b)this[k]=b[k]}function b(a){this.client=a;this._sessions={}}window._&&window._.include&&(window._.contains=window._.include);b32infohash=function(a){for(var b="",c=0;c<a.length;c=c+2)b=b+String.fromCharCode(parseInt(a.charAt(c)+a.charAt(c+1),16));a=b;parts=[];quanta=Math.floor(a.length/5);if(leftover=a%5){for(b=0;b<5-leftover;b++)a=a+"\x00";quanta=quanta+1}for(b=0;b<quanta;b++){c1=(a.charCodeAt(b*5)<<8)+a.charCodeAt(b*5+1);c2=(a.charCodeAt(b*5+
2)<<8)+a.charCodeAt(b*5+3);c3=a.charCodeAt(b*5+4);c2=c2+((c1&1)<<16);c3=c3+((c2&3)<<8);parts=parts+"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charAt(c1>>11);parts=parts+"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charAt(c1>>6&31);parts=parts+"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charAt(c1>>1&31);parts=parts+"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charAt(c2>>12);parts=parts+"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charAt(c2>>7&31);parts=parts+"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charAt(c2>>2&31);parts=parts+"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charAt(c3>>
5);parts=parts+"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charAt(c3&31)}leftover==1?parts=parts.slice(0,-6)+"======":leftover==2?parts=parts.slice(0,-4)+"====":leftover==3?parts=parts.slice(0,-3)+"===":leftover==4&&(parts=parts.slice(0,-1)+"=");return parts};Formatters={};APISpecification=new function(){this.app=[{name:"name"},{name:"update_url"},{name:"version"}];this.torrent=[{name:"hash"},{name:"status",type:"int",bits:["started","checking","start after check","checked","error","paused","queued","loaded"]},
{name:"name"},{name:"size",type:"int"},{name:"progress",type:"int"},{name:"downloaded",type:"int"},{name:"uploaded",type:"int"},{name:"ratio",type:"int"},{name:"up_speed",type:"int"},{name:"down_speed",type:"int"},{name:"eta",type:"int"},{name:"label"},{name:"peers_connected",type:"int"},{name:"peers_swarm",type:"int",alias:"peers_in_swarm"},{name:"seed_connected",type:"int",alias:"seeds_connected"},{name:"seed_swarm",type:"int",alias:"seeds_in_swarm"},{name:"availability",type:"int"},{name:"queue_position",
type:"int",alias:"queue_order"},{name:"remaining",type:"int"},{name:"download_url"},{name:"rss_feed_url"},{name:"message"},{name:"stream_id"},{name:"added_on",type:"int"},{name:"completed_on",type:"int"},{name:"app_update_url"},{name:"directory"},{name:"webseed_enabled"}];this.peer=[{name:"country"},{name:"ip"},{name:"hostname"},{name:"protocol",type:"int"},{name:"port",type:"int"},{name:"client"},{name:"flags"},{name:"complete",type:"int"},{name:"down_speed",type:"int"},{name:"up_speed",type:"int"},
{name:"pending",type:"int"},{name:"requests",type:"int"},{name:"waited",type:"int"},{name:"uploaded",type:"int"},{name:"downloaded",type:"int"},{name:"hasherr",type:"int"},{name:"peer_download_rate",type:"int"},{name:"maxup",type:"int"},{name:"maxdown",type:"int"},{name:"queued",type:"int"},{name:"inactive",type:"int"},{name:"relevance",type:"int"}];this.file=[{name:"name"},{name:"size",type:"int",unit:"bytes"},{name:"downloaded",type:"int",unit:"bytes"},{name:"priority",type:"int"},{name:"first_piece",
type:"int"},{name:"num_pieces",type:"int"},{name:"streamable",type:"bool"},{name:"encoded_rate",type:"int"},{name:"duration",type:"int"},{name:"width",type:"int"},{name:"height",type:"int"},{name:"stream_eta",type:"int"},{name:"streamability",type:"int"}];this.client_setting=[{name:"name"},{name:"type",type:"int",value_map:{"0":"int",1:"bool",2:"str"}},{name:"value"},{name:"access",type:"object",value_map:{Y:"read/write",R:"readonly",W:"writeonly"}}];this.torrent_setting=[{name:"hash"},{name:"trackers"},
{name:"ulrate",type:"int"},{name:"dlrate",type:"int"},{name:"superseed",type:"bool"},{name:"dht",type:"bool"},{name:"pex",type:"bool"},{name:"seed_override",type:"bool"},{name:"seed_ratio",type:"int",unit:"per1000"},{name:"seed_time",type:"int",unit:"seconds"},{name:"seed_num",type:"int"},{name:"ulslots",type:"int"}];this.feed=[{name:"ident",type:"int"},{name:"enabled",type:"bool"},{name:"usefeedtitle",type:"bool"},{name:"user_selected",type:"bool"},{name:"programmed",type:"bool"},{name:"download_state",
type:"int"},{name:"url",type:"bool"},{name:"next_update",type:"int"},{name:"items",type:"object"}];this.feed_item=[{name:"name"},{name:"name_full"},{name:"url"},{name:"quality",type:"int"},{name:"codec",type:"int"},{name:"timestamp",type:"int"},{name:"season",type:"int"},{name:"episode",type:"int"},{name:"episode_to",type:"int"},{name:"feed_id",type:"int"},{name:"repack",type:"bool"},{name:"in_history",type:"bool"},{name:"torrent",type:"native-object"}];this.feed_rule=[{name:"ident",type:"int"},{name:"flags",
type:"int"},{name:"name"},{name:"filter"},{name:"not_filter"},{name:"directory"},{name:"feed",type:"int"},{name:"quality",type:"int"},{name:"label"},{name:"postpone_mode",type:"int"},{name:"last_match",type:"int"},{name:"smart_ep_filter",type:"int"},{name:"repack_ep_filter",type:"int"},{name:"episode_filter_str"},{name:"episode_filter",type:"bool"},{name:"resolving_candidate",type:"bool"}];this.label=[{name:"name"},{name:"contains",type:"int"}];this.feed_encoding=["?","MPEG","MPEG-2","MPEG-4","Real",
"WMV","Xvid","DivX","X264","H264","WMV-HD","VC1"];this.feed_quality=["?","HDTV","TVRip","DVDRip","SVCD","DSRip","DVBRip","PDTV","HR.HDTV","HR.PDTV","DVDR","DVDScr","720p","1080i","1080p","WebRip","SatRip"];a.each(["torrent","peer","file","client_setting","torrent_setting","app","feed","feed_item","feed_rule","label"],function(b){this[b+"_lookup"]={};a.each(this[b],function(a,c){this[b+"_lookup"][a.name]=c},this)},this)};var c=function(a,b,c,d){return function(){var e=this,f=arguments,h=f[c.length];
if(e.fetched&&!d)return h?h(c.apply(e,f)):c.apply(e,f);a.apply(e,[h?function(a){b.apply(e,[a]);h(c.apply(e,f))}:function(a){b.apply(e,[a]);c.apply(e,f)}]);return{}}};DataFreshnessManager=function(){};DataFreshnessManager.prototype={start:function(){},stop:function(){}};RaptorRequestManager=function(a,b){this.__name__="RaptorRequestManager";this.api=b;this.client=this.api.client=a;this.last_successful_request_time=null;this.request_queue=[];this.current_request=null;this.request_count_failure=this.request_count_success=
0;this.listResponses=[]};RaptorRequestManager.prototype={proxy_base_url:function(a,b){if(config.local_discovery)return"http://"+config.local_discovery+"/proxy";if(a){if(b)var c=a.split(":"),d=parseInt(c[2],10)+config.port_delta,a="http://"+c[1].slice(2,c[1].length)+":"+d;return a+(config.proxy_prefix||"/client/proxy")}return config.proxy_prefix||"/client/proxy"},request_returned:function(a){a.status!="timeout"&&(a.xhr&&a.xhr.status==200)&&parseInt(a.xhr.getResponseHeader("content-length"),10);if(this.request_queue.length>
0){a=this.request_queue[0];this.request_queue=this.request_queue.slice(1,this.request_queue.length);console.log("pushing request off queue");a()}},proxy:function(a,b,c){fjQuery.ajax({url:this.proxy_base_url()+"?"+jQuery.param(a),success:function(a,d,e){if(e.status==0){var f={status:d,xhr:e};if(c)c(f);else{console.log("proxy getfile failed. (xhr status 0) jquery ajax calls this success???");throw Error(f);}}console.log("successfully downloaded file");b(a,d,e)},error:function(a,b){var d={xhr:a,status:b};
if(c)c(d);else{console.log("proxy getfile failed :-(");throw Error(d);}}})},post_raw:function(a,b,c,d,e){config.webui?this.api.webui_get(a,b||{},c,e):this.api.post(a,b||{},c,e)},post:function(b,c,d,e,f){function h(b,c,e){i.request_count_success=i.request_count_success+1;i.request_returned({json:b,status:c,xhr:e});i.last_successful_request_time=new Date;c=a.keys(b);if(b.build)i.version=b.build;b.torrents&&i.client.torrent.eat(b);(b.torrentm||b.torrentc)&&i.client.torrent.eat(b);if(b.label){i.client.label.eat(b);
i.client.label.correct_counts_for_primary(i.client.torrent._torrents)}b.apps!==void 0&&((config.client_apps||config.cookies&&config.cookies.client_apps)&&!config.webui&&!config.classic_iphone_interface)&&i.client.app.eat(b);b.sessions&&i.client.session.eat(b);for(key in b)if(key.match("rssfeed")){i.client.feed.eat(b);break}for(key in b)if(key.match("rssfilter")){i.client.feedrule.eat(b);break}b.apps&&i.client.app.eat(b);if(b.files)for(var g=0;g<b.files.length/2;g++){var f=b.files[g*2],f=i.client.torrent.get(f);
f.file.eat(b)}if(b.peers)for(g=0;g<b.peers.length/2;g++){f=b.peers[g*2];f=i.client.torrent.get(f);f.peer.eat(b)}if(b.props){f=i.client.torrent.get(b.props[0].hash);f.setting.eat(b)}d&&d(b,e);config.build!="embedded"&&(window.utWebUI&&window.utweb&&!window.utweb._logging_out)&&utWebUI.loadList(b);i.client.call_update_listeners(c)}function j(a){i.request_count_failure=i.request_count_failure+1;i.request_returned(a);var b=a.xhr;if(e)return e(a);i.client.call_update_fail_listeners(b,a.status,a)}function l(){config.webui?
i.api.webui_get(b,c||{},h,j,f):i.api.post(b,c||{},h,j,f)}var i=this;if(i.request_queue.length>0){console.log("queueing request");i.request_queue.push(l)}else l()}};var e=function(b,c){var d=this;d.__name__="Peer";d.manager=b;d._data=c;a.map(APISpecification.peer,function(a,b){d[a.name]=c[b]});d.properties={all:function(){return d},keys:function(){return a.keys(d)},set:function(){},get:function(a){return d[a]!==void 0?d[a]:null}};d.uid=d.ip+":"+d.port};e.prototype={get_progress_text:function(){return""},
get_progress_color:function(){return this.complete==1E3?"blue":"green"}};var f=function(a){this.__name__="PeerManager";this.torrent=a;this.fetched=false;this._peers={}};f.prototype=new function(){var b=function(b){var c=this;this._peers={};for(var d=0,g=0;g<b.peers.length/2;g++)if(b.peers[g*2]==this.torrent.hash){b=b.peers[g*2+1];this.fetched=true;this.fetch_time=new Date;this._peers={};a.each(b,function(a){a=new e(c,a);a.uid=a.uid+d;d++;c._peers[a.uid]=a});this._data=a.values(this._peers);return this._peers}},
d=function(a){_this.client.raptor.post({action:"getpeers"},{hash:this.torrent.hash},a)};this.all=c(d,b,function(){return this._peers});this.update=c(d,b,function(){return this._peers},true);this.keys=c(d,b,function(){return a.keys(this._peers)});this.get=c(d,b,function(a){return this._peers[a]});this.data=function(){return this._data};this.eat=function(a){return b.apply(this,[a])}};var h=function(b,c){var d=this;d.__name__="File";d.manager=b;d.torrent=b.torrent;d._data=c;a.map(APISpecification.file,
function(a,b){d[a.name]=c[b]});d.properties={all:function(){return d},keys:function(){return a.keys(d)},set:function(){},get:function(a){return d[a]!==void 0?d[a]:null}};d.uid=d.name;d.progress=Math.floor(d.downloaded/d.size*1E3);d.extension=this.get_extension()};h.prototype={__render:function(){return'<span style="font-size:120%">'+this.name+"</span>"},isImage:function(){if(a.contains(["png","jpg","gif","jpeg","bmp","ico"],this.extension))return this},vestel_play:function(){console.log("vestel play on",
this);var a=document.createElement("object");console.log("vid object obj",a);a.setAttribute("type","video/mp4");var b={nonssl:true};if(config.webui)b.include_host=true;b=this.get_link("inline","DOWNLOAD",b);a.setAttribute("data",b);a.setAttribute("id","player_object");a.setAttribute("width",1280);a.setAttribute("height",720);a.setAttribute("style","z-index:99");jQuery("#app_container").hide();console.log("player container",jQuery("#player_container")[0]);jQuery("#player_container")[0].appendChild(a);
console.log("setup object with url",b);var c=this;setTimeout(function(){console.log("telling it to play now");c.play_obj=document.getElementById("player_object");c.play_obj.play(1)},1E3);jQuery(document).keydown(function(a){if(a.keyCode==413){if(a=document.getElementById("player_object")){jQuery("#app_container").show();jQuery("#player_container").hide();a.stop();this.playing=false;a.parentNode.removeChild(a)}}else if(a.keyCode==19)if(a=document.getElementById("player_object")){console.log("player speed",
a.speed);a.speed=0}})},sling:function(){console.log("sling called");return this.vestel_play()},open:function(){console.log("file",this,this.name,"open");config.utweb&&window.utweb&&this.playable();window.open(this.get_link())},determine_profile:function(){if(this._avdata){var a=this._avdata.audioCodecName.split("_"),b=a[a.length-1],a=this._avdata.videoCodecName.split("_"),a=a[a.length-1],c=this._avdata.videoBitrate/1024,d=this._avdata.audioBitrate/1024,e=this._avdata.frameWidth,f=this._avdata.frameHeight,
h={};if(b=="AAC"){if(d<=1152)h.audio="HD"}else if(b=="MP3"){if(d<=320)h.audio="SD"}else if(b=="AC3"&&d<=640)h.audio="SD";if(a=="H264"){if(c<=2E4&&e<=1920&&f<=1080)h.video="HD"}else if(a=="MPEG4"&&c<=2E3&&e<=720&&f<=576)h.video="SD";return h}},get_av_codecs:function(){var a=this._avdata.audioCodecName.split("_"),b=a[a.length-1],a=this._avdata.videoCodecName.split("_");return{audio:b,video:a[a.length-1]}},get_transcode_options:function(b){var c=["mpeg","avi","mp4","wav","mpg","mov","mp3","ts","asf",
"wma","wmv","mkv","mka","ogg","vob","webm","aiff"],d=["default","mpeg1","mpeg2","mpeg4_p2","h264","copy"],e=["default","ac3","mp3","copy"],f=["default","vga","svga","hd480","hd720","hd1080"],h={},i=this.get_av_codecs();if(b.preset=="HD"){videoCodec=i.video=="H264"?"copy":"h264";audioCodec=i.audio=="MP3"||i.audio=="AC3"?"copy":"mp3";if(this._avdata.videoBitrate==0)this._avdata.videoBitrate=2048E4;a.extend(h,{fileExtension:c.indexOf("mkv"),videoCodec:d.indexOf(videoCodec),audioCodec:e.indexOf(audioCodec),
preserveQuality:1,videoBitrate:Math.floor(parseInt(this._avdata.videoBitrate)/1024),audioBitrate:Math.floor(parseInt(this._avdata.audioBitrate)/1024),frameSize:f.indexOf("default"),fileName:this.get_local_path(),targetFile:this.get_local_path()+".__conv_HD"})}if(b.preset=="SD"){if(this._avdata.videoBitrate==0)this._avdata.videoBitrate=2048E3;videoCodec=i.video=="MPEG4"?"copy":"mpeg4_p2";audioCodec=i.audio=="MP3"||i.audio=="AC3"?"copy":"mp3";a.extend(h,{fileExtension:c.indexOf("avi"),videoCodec:d.indexOf(videoCodec),
audioCodec:e.indexOf(audioCodec),preserveQuality:0,videoBitrate:Math.floor(parseInt(this._avdata.videoBitrate)/1024),audioBitrate:Math.floor(parseInt(this._avdata.audioBitrate)/1024),frameSize:f.indexOf("svga"),fileName:this.get_local_path(),targetFile:this.get_local_path()+".__conv_SD"})}return h},getavdata:function(a){function b(c){a({error:c})}var c=this,d="http://127.0.0.1:8080/formatquery?type=avdata&file="+escape(this.get_local_path());console.log("query av data",d);c.manager.torrent.manager.client.raptor.post({action:"get-url"},
{url:d},function(d){if(d.html)try{var e=JSON.parse(d.html);console.log("got av data",e);if(window.ffmpeg_meta){e.audioCodecName=ffmpeg_meta.codecs[e.audioCodec];e.videoCodecName=ffmpeg_meta.codecs[e.videoCodec]}c._avdata=e;a(e)}catch(f){b(d)}else b(d)},b)},get_local_path:function(){return this.manager.torrent.directory+"\\"+this.name},playable:function(){return a.contains(["mp3","m4v","flv","wmv","avi","ogg","mp4","mkv","mov","mp4","mpg","mpeg","flac","3gp"],this.extension.toLowerCase())||this.encoded_rate},
html5_playable:function(){return a.contains(["mp4","mp3","wav","webm","ogg","3gp"],this.extension.toLowerCase())},demo_playable:function(){return a.contains(["avi","mp4","mkv","mp4","3gp"],this.extension.toLowerCase())||this.encoded_rate>0},get_link:function(a,b,c){var d=c&&c.include_host,c=c&&c.nonssl,b={sid:this.manager.torrent.stream_id,file:this.id,service:b||"DOWNLOAD",qos:0,disposition:a||"inline"},a=this.manager.torrent.manager.client,e=!a.raptor.api.pairing&&config.utweb&&!config.local_discovery?
"/"+this.get_filename():"",c=a.raptor.api.pairing?a.raptor.api.pairing.local_url+"/proxy"+e+"?"+jQuery.param(b):a.raptor.proxy_base_url(a.raptor_host,c)+e+"?"+jQuery.param(b);a.raptor_host&&(c=c+"&"+a.client_qs());d&&(c="http://"+document.location.hostname+":"+document.location.port+c);return c},get_webui_stream_link:function(){if(window.location.protocol=="https:")throw Error("VLC cant handle https streams :-( sorry!");return"http://"+document.location.hostname+":"+document.location.port+this.get_link("inline",
"STREAMING")},get_nonssl_link:function(a){a={sid:this.manager.torrent.stream_id,file:this.id,service:"DOWNLOAD",qos:0,t:(new Date).getTime(),disposition:a||"inline"};return"http://"+document.location.hostname+":"+(parseInt(document.location.port,10)+config.port_delta)+this.manager.torrent.manager.client.raptor.proxy_base_url()+"?"+jQuery.param(a)},get_forward_nonssl_link:function(){var a={sid:this.manager.torrent.stream_id,file:this.id,service:"STREAMING",qos:0,GUID:jQuery.cookie("GUID"),username:jQuery.cookie("bt_user")};
return"http://"+document.location.hostname+":"+(parseInt(document.location.port,10)+config.port_delta)+"/talon/streamfile?"+jQuery.param(a)},get_web_seed_link:function(){return config.utweb?"http://"+document.location.hostname+":"+(parseInt(document.location.port,10)+1E3)+"/talon/seed/"+this.manager.torrent.manager.client.data.cid+"/content/"+this.manager.torrent.stream_id+"/"+escape(this.name):this.manager.torrent.file.length==1?"/seed/0/content/"+this.manager.torrent.stream_id+"/"+escape(this.name.replacebacks()):
"/seed/0/content/"+this.manager.torrent.stream_id+"/"+escape(this.manager.torrent.name)+"/"+escape(this.name.replacebacks())},get_talon_stream:function(a,b){var c={sid:this.manager.torrent.stream_id,file:this.id,qos:0,disposition:a||"inline",service:b||"DOWNLOAD",GUID:jQuery.cookie("GUID"),username:jQuery.cookie("bt_user")};return"http://"+document.location.hostname+":"+(parseInt(document.location.port,10)-1E3)+"/talon/proxystreamfile?"+jQuery.param(c)},get_progress_text:function(){return this.progress/
10+locale("FI_COL_PCNT")},get_progress_color:function(){return"green"},get_filename:function(){var a=this.name.split("\\");return a[a.length-1]},get_extension:function(){var a=this.name.split(".");return a.length==1?"":a[a.length-1].toLowerCase()},isCompleted:function(){return this.downloaded==this.size},setPriority:function(a){var b=this.manager.torrent;b.manager.client.raptor.post({action:"setprio",p:a,f:this.id},{hash:b.hash})}};var j=function(a){this.__name__="FileManager";this.torrent=a;this.files=
{};this.fetched=false;this.length=0};j.prototype=new function(){var b=function(b){var c=this;this.length=b.files.length/2;for(var d=0;d<b.files.length/2;d++)if(b.files[d*2]==this.torrent.hash){b=b.files[d*2+1];this.fetched=true;this.fetch_time=new Date;a.each(b,function(a,b){var d=new h(c,a);d.id=b;c.files[d.uid]=d});this._data=a.values(this.files);a.defer(function(){c.torrent.manager._trigger_event("fileStatus",{message:"Files Updated",manager:c})});return this.files}},d=function(a){this.torrent.manager.client.raptor.post({action:"getfiles"},
{hash:this.torrent.hash},a)};this.all=c(d,b,function(){return this.files});this.update=c(d,b,function(){return this.files},true);this.keys=c(d,b,function(){return a.keys(this.files)});this.get=c(d,b,function(a){return this.files[a]});this.eat=function(a){return b.apply(this,[a])};this.data=function(){return this._data}};var i=function(a,b,c){this.__name__="TorrentSetting";this.manager=a;this.name=b;a=APISpecification.torrent_setting_lookup[b];if(APISpecification.torrent_setting[a])this.type="string";
else this.type=(a=APISpecification.torrent_setting[a])?a.type||"string":"string";this.value=this.type=="bool"?!!c:c};i.prototype={set:function(a,b){var c=this;this.manager.client.raptor.post({action:"setprops",s:this.name,v:a},{hash:this.manager.torrent.hash},b?function(d){c.value=a;b.apply(c,[d])}:function(){c.value=a})}};var m=function(a){this.__name__="TorrentSettingManager";this.torrent=a;this.settings={};this.fetched=false};window.TorrentSettingManager=m;m.prototype=new function(){var b=function(b){this.fetched=
true;this.fetch_time=new Date;a.map(b.props[0],function(a,b){var c=new i(this,b,a);this.settings[b]=c},this);return this},d=function(a){this.client.raptor.post({action:"getprops"},{hash:this.torrent.hash},a)};this.eat=function(a){b.apply(this,[a])};this.keys=function(){return a.map(APISpecification.torrent_setting,function(a){return a.name})};this.all=c(d,b,function(){return this.settings});this.get=c(d,b,function(a){return this.settings[a]})};var l=function(a){this.__name__="TorrentManager";this.client=
a;this.status_categories=["Downloading","Completed","Active","Inactive","Seeding","Not Alone","All"];this.cacheid=null;this.fetched=false;this.hashindex={};this._removed=[];this._changed=[];this._torrents={};this._rawtorrents={};this._event_listeners={}};window.TorrentManager=l;l.prototype=new function(){this.data=function(){return a.map(this._torrents,function(a){return a})};var b=function(b){var c=this;this.fetched&&a.each(a.keys(c._torrents),function(a){delete c._torrents[a]});this.cacheid=b.torrentc;
a.map(b.torrents,function(a){var b=a[APISpecification.torrent_lookup.hash];c._rawtorrents[b]=a;c._torrents[b]=new r(c,a)});this.update_category_counts();return this},d=function(b){var c=this;this.cacheid=b.torrentc;this._changed=a.map(b.torrentp,function(a){return new r(c,a)});this._removed=a.map(b.torrentm,function(a){return c.get(a)});a.each(this._removed,function(b){var d={hash:b.hash,state:-1,url:b.download_url,message:"Torrent File Removed",status:200};a.defer(function(){c._trigger_event("torrentStatus",
d)});delete c._torrents[b.hash];delete c._rawtorrents[b.hash]});a.each(this._changed,function(b){var d=b.hash,e=c._torrents[d];if(e){if(e.progress!=1E3&&b.progress==1E3){var f={hash:e.hash,state:1,url:e.download_url,message:"Torrent File Completed",status:200};a.defer(function(){c._trigger_event("torrentStatus",f)})}e.data(b.data());e.status_array=e.get_status()}else{if(c._new_torrent_listeners.length)for(e=0;e<c._new_torrent_listeners.length;e++){var g=c._new_torrent_listeners[e];a.defer(function(){g(b)})}f=
{hash:b.hash,state:1,url:b.download_url,message:"Torrent File Added",status:200};if(b.size==0)f.url="magnet:?xt=urn:btih:"+b.hash.toUpperCase();a.defer(function(){c._trigger_event("torrentStatus",f)});c._torrents[d]=b;c._rawtorrents[d]=b.data()}});this._changed=a.map(this._changed,function(a){return c.get(a.hash)});this.update_category_counts();return this},e=function(a){this.cacheid&&this.cacheid!=null&&typeof this.cacheid!="undefined"?this.client.raptor.post({list:1,cid:this.cacheid},{},a):this.client.raptor.post({list:1},
{},a)},f=function(a){this.fetched=true;this.fetch_time=new Date;return a.torrentp||a.torrentm?d.apply(this,[a]):b.apply(this,[a])};this.calculate_totals=function(){var b=a.reduce(this._torrents,function(a,b){return a+b.up_speed},0),c=a.reduce(this._torrents,function(a,b){return a+b.down_speed},0);return{total_up_speed:b,total_down_speed:c}};this.countInCategory=function(b){var c=0;a.each(this.all(),function(a){a.matchesCategory(b)&&(c=c+1)});return c};this._new_torrent_listeners=[];this.add_new_torrent_listener=
function(a){this._new_torrent_listeners.push(a)};this.update_category_counts=function(){var b=this;this.category_counts={};a.each(this.status_categories,function(a){b.category_counts[a]=b.countInCategory({status:a})})};this.add_event_listener=function(a,b){this._event_listeners[a]||(this._event_listeners[a]=[]);this._event_listeners[a].push(b)};this._trigger_event=function(b,c){var d=null;if(window.btapp)d=window.btapp;else if(window.frames.length==2)d=window.frames[1].btapp;d&&a.defer(function(){d._trigger_event(b,
c)});var e=this._event_listeners[b];e&&a.each(e,function(b){a.defer(function(){b(c)})})};this.add=function(a,b){this.client.raptor.post({action:"add-url"},{s:a},b)};this.add_from_app=function(a,b,c){this.client.raptor.post({action:"add-url"},{s:a,app_update_url:b.update_url},c)};this.addfile=function(a,b){console.log("addfile called");this.client.raptor.post({action:"add-file",p:1,uu:1},{torrent_file:a},b);console.log("addfile call success")};this.eat=function(a){return f.apply(this,[a])};this.keys=
c(e,f,function(){return a.keys(this._torrents)});this.all=c(e,f,function(){return this._torrents});this.update=c(e,f,function(){return this._torrents},true);this.get=c(e,f,function(a){return this._torrents[a.toUpperCase()]});this.command_many=function(a,b,c,d){c===void 0&&(c={});c.hash=a;this.client.raptor.post(b,c,d)};this.getwith=function(a){for(hash in this._torrents){var b=true;for(key in a)this._torrents[hash][key]!=a[key]&&(b=false);if(b)return this._torrents[hash]}};this.search=function(a){if(this.fetched)for(hash in this._torrents)if(this._torrents[hash].name.toLowerCase().match(a.toLowerCase()))return this._torrents[hash]};
this.getallwith=function(a){var b=[];for(uid in this._torrents){for(key in a);b.push(this._torrents[uid])}return b}};l=function(a){this.__name__="FeedManager";this.client=a;this.feeds=null;this.fetched=false};window.FeedManager=l;l.prototype=new function(){var b=function(b){this.cacheid=b.torrentc;this.feeds={};a.map(b.rssfeeds,function(a){a=new n(this,a);this.feeds[a.ident]=a},this);return this},d=function(b){var c=this;this.cacheid=b.torrentc;var d=b.rssfeedp;a.map(b.rssfeedm,function(a){delete c.feeds[a]});
a.map(d,function(a){a=new n(c,a);c.feeds[a.ident]=a})},e=function(a){this.fetched=true;this.fetch_time=new Date;return a.rssfeedm||a.rssfeedp?d.apply(this,[a]):b.apply(this,[a])},f=function(a){this.client.raptor.post({list:1},{},a)};this.eat=function(a){return e.apply(this,[a])};this.keys=c(f,e,function(){return a.keys(this.feeds)});this.update=c(f,e,function(){return this.feeds},true);this.all=c(f,e,function(){return this.feeds});this.get=c(f,e,function(a){return this.feeds[a]});this.getwith=function(a){for(feedid in this.feeds){var b=
true;for(key in a)if((key=="url"?this.feeds[feedid][key].split("|")[1]:this.feeds[feedid][key])!=a[key])b=false;if(b)return this.feeds[feedid]}};this.add=function(a,b){this.client.raptor.post({action:"rss-update"},{url:a},b)};this.getByIdent=c(f,b,function(a){for(var b in this.feeds)if(this.feeds[b].ident==a)return this.feeds[b]})};var n=function(b,c){var d=this;d.__name__="Feed";d.manager=b;d._items={};d._data=c;a.map(APISpecification.feed,function(b,e){b.name=="items"?a.each(c[e],function(a){var b=
new o(d,a);b.torrent&&a.push(b.torrent);d._items[b.uid]=b}):d[b.name]=c[e]},this)};n.prototype={get_name:function(){return this.url.split("|")[0]},get_url:function(){return this.url.split("|")[1]},update:function(a,b){this.manager.client.raptor.post({action:"rss-update",feedid:this.ident},{alias:a,url:b})},tryadd:function(a,b,c){function d(){if(new Date-h>f){console.log((f/1E3).round(0),"seconds after attempted add feed",a,"as torrent");a.url_contains_hash()&&a.add_magnet();c&&c()}else if(a.get_torrent()){console.log("successfully turned rss feed item into torrent");
b&&b()}else setTimeout(d,e)}var e=200,f=1E4,h=new Date;setTimeout(d,e)},isSubscribed:function(){var a=this.manager.client.feedrule.all(),b;for(b in a){var c=a[b];if(c.filter=="*"&&c.feed==this.ident&&c.flags==1)return true}return false},remove:function(){console.log("feed remove please");this.manager.client.raptor.post({action:"rss-remove",feedid:this.ident})},enable:function(){console.log("enable feed...");this.manager.client.raptor.post({action:"rss-update",feedid:this.ident,enabled:true})},disable:function(){console.log("disable feed...");
this.manager.client.raptor.post({action:"rss-update",feedid:this.ident,enabled:false})},data:function(b){if(b){var c=this,b=a.filter(this.manager.client.torrent.all(),function(a){return a.rss_feed_url==c.get_url()}),d={};a.each(this._items,function(a){d[a.url]=true});b=a.filter(b,function(a){return d[a.download_url]==void 0});return b.concat(a.values(this._items))}return a.values(this._items)}};var o=function(b,c){var d=this;d.__name__="FeedItem";d.feed=b;a.map(APISpecification.feed_item,function(a,
b){d[a.name]=c[b]});d.uid=d.url;var e=this.get_torrent();if(e)this.torrent=e};o.prototype={__html__:function(){var a='Feed item: "'+this.name_full+'" with url <a target="_new" href="'+this.url+'">'+this.url+"</a>";this.url_contains_hash()&&(a=a+"<p>The URL contains what appears to be an infohash. We'll try to add using a magnet link (using the distributed hash table to find the torrent file)</p>"+('<a href="'+this.magnet_url()+'">magnet link</a>'));return a},url_contains_hash:function(){var a=this.url.match("[0-9a-fA-F]{40}");
if(a)return a[0]},magnet_url:function(){var a=this.url_contains_hash();if(a)return"magnet:?xt=urn:btih:"+a.toUpperCase()+"&dn="+escape(this.name_full)+"&tr"+escape("http://denis.stalker.h3q.com:6969/announce")},add_magnet:function(){var a=this.magnet_url();if(a){console.log("adding feed",this,"via magnet link");this.feed.manager.client.raptor.post({action:"add-url",feedid:this.feed.ident},{s:a})}},add:function(){var a={action:"add-url",feedid:this.feed.ident},b={s:this.url};console.log("feeditem add",
a,b);this.feed.manager.client.raptor.post(a,b);var c=this;this.url_contains_hash()&&setTimeout(function(){c.add_magnet()},200)},mutator_add_rss_url:function(){return this.url+(this.url[this.url.length-1]=="/"?"":"/")+"download.torrent"},get_torrent:function(){var a=this.feed.manager.client.torrent.getwith({download_url:this.url,rss_feed_url:this.feed.get_url()});if(a)return a;if(a=this.url.match("[0-9a-fA-F]{40}"))if(a=this.feed.manager.client.torrent.get(a[0].toUpperCase()))return a}};var p=function(b,
c){var d=this;d.manager=b;a.map(APISpecification.feed_rule,function(a,b){d[a.name]=c[b]})};p.prototype={getfeed:function(){return this.manager.client.feed.getByIdent(this.feed)}};l=function(a){this.__name__="FeedRuleManager";this.client=a;this.rules=null;this.fetched=false};window.FeedRuleManager=l;l.prototype=new function(){var b=function(b){var c=this;this.rules={};b.rssfilters&&a.each(b.rssfilters,function(a){a=new p(c,a);c.rules[a.ident]=a});return this},d=function(b){var c=this;this.cacheid=
b.torrentc;var d=b.rssfilterp;(b=b.rssfilterm)&&a.each(b,function(a){delete c.rules[a]});d&&a.each(d,function(a){a=new p(c,a);c.rules[a.ident]=a})},e=function(a){this.fetched=true;this.fetch_time=new Date;return a.rssfilterm||a.rssfilterp?d.apply(this,[a]):b.apply(this,[a])},f=function(a){this.client.raptor.post({list:1},{},a)};this.keys=c(f,e,function(){return a.keys(this.rules)});this.all=c(f,e,function(){return this.rules});this.get=c(f,e,function(a){return this.rules[a]});this.eat=function(a){return e.apply(this,
[a])}};var r=function(b,c){var d=this;d.__name__="Torrent";d.manager=b;a.map(APISpecification.torrent,function(a,b){d[a.name]=c[b];a.alias&&(d[a.alias]=c[b])});d.uid=d.hash.toUpperCase();d.data(c);d.properties={all:function(){return d},keys:function(){return a.keys(d)},set:function(){},get:function(a,b){return d[a]!==void 0?d[a]:b?b:null}};d.file=new j(d);d.setting=new m(d);d.peer=new f(d);d.status_array=this.get_status()};r.prototype=new function(){var b=APISpecification.torrent[APISpecification.torrent_lookup.status].bits;
a.extend(this,{__html__:function(){return this.name+"oooooieee!"},should_be_hidden:function(){return this.label==="uChat"},magnet_link:function(){return"magnet:?xt=urn:btih:"+this.hash},coverart:function(){var a=this.file.keys();if(this.file.get("coverart.jpg"))return this.file.get("coverart.jpg");for(var b=0;b<a.length;b++){var c=this.file.get(a[b]);if(c.isImage())return c}},get_web_seed_link:function(){return"http://"+document.location.hostname+":"+(parseInt(document.location.port,10)-1E3)+"/talon/seed/"+
this.manager.client.data.cid+"/content/"+this.stream_id},get_web_seed_torrent_link:function(){return"http://"+document.location.hostname+":"+(parseInt(document.location.port,10)-1E3)+"/talon/seed/"+this.manager.client.data.cid+"/torrent/"+this.stream_id},get_setting:function(a){if(this.setting.fetched)return this.setting.settings[a]},started:function(){return a.contains(this.status_array,"started")},context_menu_items:function(){var b=this,c=[];a.contains(this.status_array,"error")&&c.push({label:"Force Check",
callback:function(){b.callapi("recheck")}});return c},get_progress_text:function(){var b=this.progress,c=this.progress==1E3;return a.contains(this.status_array,"paused")?locale("OV_FL_PAUSED"):a.contains(this.status_array,"checking")?locale("OV_FL_CHECKED").replace(/%:\.1d%/,(b/10).toFixedNR(1)):c?a.contains(this.status_array,"queued")?a.contains(this.status_array,"started")?(this.forcestart?"[F] ":"")+locale("OV_FL_SEEDING"):locale("OV_FL_QUEUED_SEED"):a.contains(this.status_array,"started")?(this.forcestart?
"[F] ":"")+locale("OV_FL_SEEDING"):locale("OV_FL_FINISHED"):a.contains(this.status_array,"queued")&&!a.contains(this.status_array,"started")?locale("OV_FL_QUEUED"):!a.contains(this.status_array,"queued")&&!a.contains(this.status_array,"started")?locale("OV_FL_STOPPED")+" "+b/10+locale("FI_COL_PCNT"):this.forcestart?"[F] "+locale("OV_CAT_DL")+" "+b/10+locale("FI_COL_PCNT"):locale("OV_CAT_DL")+" "+b/10+locale("FI_COL_PCNT")},get_progress_color:function(){var b=this.progress==1E3,c="grey";a.contains(this.status_array,
"paused")?c="grey":a.contains(this.status_array,"error")?c="red":a.contains(this.status_array,"started")?c=b?"ltgreen":"blue":b?c="green":a.contains(this.status_array,"queued")&&(c="blue");return c},matchesCategory:function(a){if(a===void 0)return true;if(a.__name__=="Label")return a.name=="No Label"?this.label=="":this.label==a.name;if(a.status){if(this.should_be_hidden())return false;switch(a.status){case "All":return true;case "Not Alone":return this.peers_connected>0||this.seed_connected>0;case "Downloading":return this.isDownloading();
case "Completed":return this.isCompleted();case "Active":return this.isActive();case "Seeding":return this.isSeeding();case "Inactive":return!this.isActive()}}else return false},isDownloading:function(){return this.progress<1E3&&a.contains(this.status_array,"started")},isCompleted:function(){return this.progress==1E3},isActive:function(){return this.peers_connected>0||this.seed_connected>0},isSeeding:function(){return this.isCompleted()&&a.contains(this.status_array,"started")&&!a.contains(this.status_array,
"paused")},hasLabel:function(a){return this.label==a},data:function(b){var c=this;if(b===void 0)return this._data;this._data=b;a.map(APISpecification.torrent,function(a,d){c[a.name]=b[d];a.alias&&(c[a.alias]=b[d])})},get_status:function(){var c=this,d=[];a.map(b,function(a,b){Math.pow(2,b)&c.status&&d.push(a)});this.forcestart=!a.contains(d,"queued")&&a.contains(d,"started")?true:false;return c._statuses=d},callapi:function(b,c){var d={action:b};c&&(b=="add-url"?a.extend(d,{s:c}):a.extend(d,{p:c}));
this.manager.client.raptor.post(d,{hash:this.hash})},single_file_playable:function(){var b=a.filter(a.values(this.file.all()),function(a){return a.playable()});if(b.length>0)return b[0]},start:function(a){a?this.callapi("forcestart"):this.callapi("start")},stop:function(){this.callapi("stop")},pause:function(){this.callapi("pause")},unpause:function(){this.callapi("unpause")},forcestart:function(){this.callapi("forcestart")},recheck:function(){this.callapi("recheck")},remove:function(){this.callapi("remove")},
removedata:function(){this.callapi("removedata")},setprio:function(a){this.callapi("setprio",a)},set_property:function(a,b){this.manager.client.raptor.post({action:"setprops"},{hash:this.hash,s:a,v:b})},set_priority:function(a){this.setprio(a)},queuebottom:function(){this.callapi("queuebottom")},queuedown:function(){this.callapi("queuedown")},queuetop:function(){this.callapi("queuetop")},queueup:function(){this.callapi("queueup")},update:function(a){this.manager.update(a)},get_label:function(){return this.manager.client.label.get(this.label)},
get_feed:function(){return this.manager.client.feed.getwith({url:this.rss_feed_url})},get_app:function(){if(this.app_update_url)return this.manager.client.app.getwith({update_url:this.app_update_url})}})};var s=function(b,c){var d=this;d.manager=b;d.__name__="ClientSetting";var e=APISpecification.client_setting_lookup.type,f=APISpecification.client_setting[e].value_map[c[e]];a.map(APISpecification.client_setting,function(a,b){a.name=="access"?d.access=a.value_map[c[b].access]:d[a.name]=a.value_map?
a.value_map[c[b]]:a.name=="value"?f=="int"?parseInt(c[b],10):f=="bool"?c[b]=="true":c[b]:c[b]})};s.prototype=new function(){this.set=function(a){this.manager.client.raptor.post({action:"setsetting",s:this.name,v:a})}};l=function(b){this.__name__="AppManager";this.client=b;this.fetched=false;this._apps={};this.featured_apps_lookup={};if(!(config.client_apps||config.cookies&&config.cookies.client_apps)&&!config.classic_iphone_interface){if(config.webui)this.featured_apps=[{app_update_url:"http://apps.bittorrent.com/ubrowse/ubrowse.btapp",
name:"uBrowse",alias:"ubrowse"}];else{this.featured_apps=window.featured_apps?window.featured_apps:[];if(config&&config.dev_mode)this.featured_apps=this.featured_apps.concat([{app_update_url:"http://10.0.3.3/static/apps/transcode/transcode.btapp",name:"Transcode",hidden:true,alias:"transcode"}])}if(window.sha1Hash&&!config.webui){var c=this;a.each(this.featured_apps,function(a){c.featured_apps_lookup[a.app_update_url]=a.alias;var b=new t(c,[a.name,a.app_update_url,"featured"]);b._featured=true;if(a.requires)b.requires=
a.requires;c._apps[a.app_update_url]=b})}this.fetched=true}};window.AppManager=l;l.prototype=new function(){function b(c){this.fetched=true;this.fetch_time=new Date;var d=this;c.apps&&a.map(c.apps,function(a){var a=new t(d,a),b=a.uid();d._apps[b]||(d._apps[b]=a);if(a.is_store_app())this._store_app=a})}function d(){}var e={eat:function(a){b.apply(this,[a])},keys:c(d,b,function(){return a.keys(this._apps)}),all:c(d,b,function(){return this._apps}),installed_apps:c(d,b,function(){return a.filter(this._apps,
function(a){return!a.is_store_app()})}),update:c(d,b,function(){return this._apps},true),get:c(d,b,function(a){return this._apps[a]}),get_installed_count:function(){return a.filter(this._apps,function(a){return!a.is_store_app()}).length},get_store_app:function(){return this._store_app},getwith:function(a){for(uid in this._apps){var b=this._apps[uid],c=true;for(key in a)b[key]!=a[key]&&(c=false);if(c)return b}}},f=this;a.each(e,function(a,b){f[b]=a})};var t=function(b,c){this.__name__="App";this.manager=
b;this._data=c;var d=this;a.map(APISpecification.app,function(a,b){d[a.name]=c[b]});if(window.sha1Hash){this.update_url_hash=null;console.warn("sha1 hash not defined")}else this.update_url_hash=sha1Hash(this.update_url).toUpperCase()};t.prototype={uid:function(){return this.update_url},is_store_app:function(){return this.update_url=="http://apps.bittorrent.com/store/store.btapp"},get_url_name:function(){var a=this.update_url.split("/");return a[a.length-2]},get_content_path:function(a){return this.update_url in
this.manager.featured_apps_lookup?(a?"":config.static_prefix?config.static_prefix:"")+(config.webui?"/gui":"")+"/static/apps/"+this.manager.featured_apps_lookup[this.update_url]+"/":"/client/gui/apps/"+this.update_url_hash+".btapp/"},get_icon:function(){return this.get_content_path()+"icon.png?"+this.manager.client.client_qs()},get_icon_html:function(){return'<img src="'+this.get_icon()+'" title="'+this.name+'" alt="'+this.name+'" />'}};d.prototype={uid:function(){return this.guid},looks_local:function(){var a=
this.sock_ip.split(".");if(a.length==4&&(a[0]=="10"||a[0]=="172"&&parseInt(a[1])>=16&&parseInt(a[1]<32)||a.slice(0,2).join(".")=="192.168"))return true},local_gui_url:function(){return config.path_gui+"?local="+escape(this.sock_ip+":"+this.manager.client.setting.get("bind_port").value)}};window.SessionManager=b;b.prototype={eat:function(a){for(var b=0;b<a.sessions.length;b++){var c=new d(this,a.sessions[b]);this._sessions[c.uid()]=c}},current:function(){for(var a in this._sessions)if(this._sessions[a].guid==
jQuery.cookie("GUID"))return this._sessions[a]}};l=function(a){this.fetched=false;this.labels=null;this.nolabel=new u(this,["No Label",0]);this.__name__="LabelManager";this.client=a};window.LabelManager=l;l.prototype=new function(){var b=function(){this.fetched=true;this.fetch_time=new Date;this.labels={};return this};this.correct_counts_for_primary=function(b){var c={};a.each(b,function(a){(a=jQuery.trim(a.label))&&(c[a]=c[a]?c[a]+1:1)});a.each(a.keys(c),function(a){this.labels[a]=new u(this,[a,
c[a]])},this);return this};var d=function(a){this.client.raptor.post({list:1},{},a)};this.eat=function(a){return b.apply(this,[a])};this.keys=c(d,b,function(){return a.keys(this.labels)});this.all=c(d,b,function(){return this.labels});this.update=c(d,b,function(){return this.labels},true);this.get=c(d,b,function(a){return this.labels[a]})};var u=function(b,c){var d=this;d.__name__="Label";d.manager=b;a.map(APISpecification.label,function(a,b){d[a.name]=c[b]})};u.prototype={torrents:function(){var b=
this;return a.filter(this.manager.client.torrent.all(),function(a){return a.label==b.name})}};l=function(a){this.__name__="ClientSettingManager";this.client=a;this.settings=null;this.fetched=false};window.ClientSettingManager=l;l.prototype=new function(){var b=function(b){this.fetched=true;this.fetch_time=new Date;this.settings={};a.map(b.settings,function(a){a=new s(this,a);this.settings[a.name]=a},this);return this},d=function(a){this.client.raptor.post({action:"getsettings"},{},a)};this.keys=c(d,
b,function(){return a.keys(this.settings)});this.all=c(d,b,function(){return this.settings});this.get=c(d,b,function(a){return this.settings[a]});this.update=c(d,b,function(){return this.settings},true);this.set=function(a,b,c,d){this.client.raptor.post({action:"setsetting",s:a,v:b},{},c,d)}}})(exports._,jQuery);String.prototype.replacebacks=function(){return this.replace(/\\/g,"/")};(function(a){function d(a){this._clients={};this._store=fjQuery.jStorage;this._app=this._current=null;a?this.do_autologin(a):window.autologin_data&&this.do_autologin(window.autologin_data)}window.ClientManager=d;d.prototype={do_autologin:function(a){if(config.asserts)debugger;this._called_autologin=!0;a=a||window.autologin_data;window.clients=this;clients.sync(window.autologin_data.sessions,window.autologin_data.enc_keys);a=a.current_client;"remote"==a.type?clients.set_current_client(a.key):clients.set_current_client(null);
if(a=clients.get_current_client())a.go_to_gui_page();else{console.error("autologin setup client failed (should not happen) -- redirect to basic login page?");debugger}},redirect:function(a){if(config.asserts)debugger;var c=this.serialize({window_name:!0});window.name=jQuery.toJSON(c);window.location=a},login_remote:function(a,c,d){(new Client(null,this,null,d)).negotiate_session_key(a,c,d)},create_paired_client:function(a){var c=new ClientAPI;c.pairing=new Pairing(a,c);a=new Client(null,clients,{api:c});
clients.add(a);clients.set_current_client()},add_to_sessions_cookie:function(b){var c=jQuery.cookie("sessions")||"{}",c=jQuery.parseJSON(c),d=[],f;for(f in c)b.data.bt_user==c[f].u&&d.push(f);a.each(d,function(a){delete c[a]});10<a.keys(c).length&&(c={});a.extend(c,b.serialize({cookie:!0}));this.save_sessions_cookie(c)},save_sessions_cookie:function(a){var c={expires:14,path:"/",domain:config.cookie_domain};jQuery.cookie("sessions",jQuery.toJSON(a),c)},add:function(a){this._clients[a.guid]=a},sync:function(b,
c){if(b)var d=b,c=c||null;else{var d=this._store.get("falconStore.sessionKeys")||{},f={};try{f=jQuery.parseJSON(window.name)}catch(h){}window.name="";c=c||{};a.extend(c,d,f);if(window_urlparams.sessions)d=jQuery.parseJSON(window_urlparams.sessions);else if(d={},jQuery.cookie("sessions"))try{d=jQuery.parseJSON(jQuery.cookie("sessions"))}catch(j){console.error("error loading cookies from sessions cookie")}console.log("url/cookie sessions",d,"domain",window.location.href);var f={},i;for(i in c){var m=
40==i.length;void 0===d[i]&&!m&&(f[i]=!0)}for(var l in f)console.log("deleting unused encryption key for guid",l),delete c[l];this._store.set("falconStore.sessionKeys",c)}l=!1;void 0!==d.current&&(l=d.current,delete d.current);for(i in d)if(f=d[i],f.pairing_port){var f=f.pairing_port,m=i,n=new ClientAPI;n.pairing=new Pairing({foundport:f,pairing_key:m,dontscan:!0},n);f=new Client(null,clients,{api:n});console.log("client resuming from stored pairing key",f);this._clients[null]=f}else if(c&&c[i]?f.key=
c[i]:f.k&&(f.key=f.k),m={cid:f.c,bt_talon_tkt:f.t,bt_user:f.u,key:f.key},null===i)f=new Client(i,this,m),console.log("initializing paired client",f),this._clients[i]=f;else if(f.key)f=new Client(i,this,m),console.log("initializing remote client",f),this._clients[i]=f;else{console.error("cookie session without corresponding encryption key -- remove");if(config.asserts)debugger;f=new Client(i,this,m);f.remove_from_stored_sessions()}i={expires:14,path:"/",domain:config.cookie_domain};jQuery.cookie("sessions",
jQuery.toJSON(this.serialize({cookie:!0})),i);!1!==l&&(null===l?this._clients[null]&&this.set_current_client(null):this._clients[l]&&this.set_current_client(l))},register_paired_client:function(a){console.log("register paired client",a);if(this.onready)this.onready()},set_current:function(a){debugger;this.active_guid=a;jQuery.cookie("GUID",a,{expires:14,path:"/",domain:config.cookie_domain})},set_current_client:function(b){if(!(void 0===b&&this.get_current_client()))if(b&&"Client"==b.__name__)this._current=
b;else{var c=null;void 0===b?(c=this._clients[jQuery.cookie("GUID")],!c&&(config.cookies&&config.cookies.GUID)&&(c=this._clients[config.cookies.GUID],console.error("DANG! cookie was set on rapton-i-* domain -- trying using document.cookie instead. found",c)),c||(console.error("no GUID cookie set :-( -- picking the 0th client"),c=this._clients[a.keys(this._clients)[0]]),this._current=c):this._current=this._clients[b];if(this._current)console.log("set current client to",this._current.data);else if(console.log("set current client failed -- no clients"),
config.asserts&&!config.toolbar)debugger}},disable:function(){this._current=null},get_paired_client:function(){if(this._clients[null]&&this._clients[null].raptor.api.pairing)return this._clients[null]},get_remote_client:function(){for(var a in this._clients)if("null"!=a)return this._clients[a]},get_current_client:function(){return this._current},set_app:function(b){this._app=b;a.each(this._clients,function(a){a.view=b})},serialize:function(b){var c={},d;for(d in this._clients){var f=this._clients[d].serialize(b);
a.extend(c,f)}return c}};Client=function(a,c,d,f){client=this;client.__name__="Client";client.guid=a;client.raptor_host=null;client.manager=c;client.data=f&&f.for_srp_only?{}:!d&&c&&c._clients[a]?c._clients[a].data:d;!client.data&&config.webui&&(client.data={});if(void 0===window.RaptorRequestManager)console.log("client.js: models.js not loaded. key negotiation only mode.");else{client.data||(console.log("data was not specified for client -- looking in local storage"),client.manager._store.get("falconStore.sessionKeys"));
if(!client.data)throw Error("unable to fetch key for this client");a=config.webui?null:client.data.key?new srp(client.data.key):client.data.api?client.data.api.srp:new srp;a=client.data.api||new ClientAPI(a);client.raptor=new RaptorRequestManager(client,a);client.setting=new ClientSettingManager(client);client.torrent=new TorrentManager(client);client.feed=new FeedManager(client);client.feedrule=new FeedRuleManager(client);client.label=new LabelManager(client);client.app=new AppManager(client);client.session=
new SessionManager(client);client._update_listeners=[];client._update_fail_listeners=[];client._updating=!1;client._update_timeout=null;client._outbound_update_request=null;client._stop_updating=null;client.everything_fetched=!1}};Client.prototype={go_to_gui_page:function(){var a=this;if("remote"==this.connection_type())this.raptor.api.get_raptor(function(){a.go_to_gui_page_ready(a.raptor.api.info.rapton)},null,{jsonp:!0});else{var c=navigator.userAgent.match("MSIE")?{nossl:!0}:{};this.go_to_gui_page_ready(config.logout_root,
c)}},go_to_gui_page_ready:function(a,c){debugger;var d=this.manager.serialize({cookie:!0});d.current=this.guid;window.name=jQuery.toJSON(this.manager.serialize({window_name:!0}));var f=document.location.protocol;c&&c.nossl&&(f="http:");d=a+"/talon/gui/?sessions="+encodeURIComponent(jQuery.toJSON(d));"https://"!=d.slice(0,8)&&(d=f+"//"+d);window.location=d},get_name:function(){return"local"==this.connection_type()?this.setting.get("webui.uconnect_username").value+" <em>(local)</em>":"<strong>"+this.data.bt_user+
"</strong> <em>(remote)</em>"},ready:function(){return this.raptor.api.pairing?this.raptor.api.pairing.pairing_key:!0},plus_features:function(a){if(this.detailed_client_info)if(this.detailed_client_info.error)console.error("plus status error!",this.detailed_client_info);else return a?this.detailed_client_info.plus[a]:this.detailed_client_info.plus;else return null},add_update_listener:function(a){this._update_listeners.push(a)},add_update_fail_listener:function(a){this._update_fail_listeners.push(a)},
call_update_listeners:function(){for(var a=0;a<this._update_listeners.length;a++)try{this._update_listeners[a]()}catch(c){console.error("error in client update listener callback")}},call_update_fail_listeners:function(a,c,d){console.log("calling update fail listeners");for(var f=0;f<this._update_fail_listeners.length;f++)try{this._update_fail_listeners[f](a,c,d)}catch(h){console.error("error in client update listener fail callback")}},get_torrents_that_can_fetch_files:function(){return a.filter(this.torrent.keys(),
function(a){a=client.torrent.get(a);if(0!=a.size&&!a.file.fetched)return!0})},stop_updating:function(b){this._stop_updating=!0;this._outbound_update_request?(console.error("stop updating called but already an outbound request (and we dont have direct access to the xhr object"),this._stop_updating_callback=b):(this._stop_updating=this._updating=!1,b&&a.defer(b),this._update_timeout&&(console.log("stop updating -- cleared scheduled update"),clearTimeout(this._update_timeout)))},start_updating:function(a){var c=
this;if(this._stop_updating)console.error("cannot start updating because stop updating has not been processed completely");else if(this._updating)console.error("cannot start updating -- already updating!");else{this._updating=!0;this._update_opts=a||{};this._update_opts.delay=this._update_opts.interval||2E3;if(this._update_opts.fetch_files&&0<this.get_torrents_that_can_fetch_files().length)debugger;if(this._update_opts.fetch_settings)return this._outbound_update_request=!0,this.setting.all(function(){c._really_start_updating()}),
!0;c._really_start_updating()}},_really_start_updating:function(){var b=this.torrent.cacheid;this._outbound_update_request=!0;this.raptor.post({list:1,cid:b},{},a.bind(this.do_update,this),a.bind(this.do_update_failed,this));return!0},destroy:function(){delete this.manager._clients[this.guid];this.data=this.setting=this.session=this.label=this.feed=this.torrent=this.raptor=this.raptor.api=null},do_update_failed:function(b,c,d){this._outbound_update_request=!1;this._stop_updating_callback&&(a.defer(this._stop_updating_callback),
this._stop_updating_callback=null);this._stop_updating?this._updating=this._stop_updating=!1:this.call_update_fail_listeners(b,c,d)},do_update:function(){this._outbound_update_request=!1;if(this._update_opts.first_update){var b=this._update_opts.first_update;delete this._update_opts.first_update;b()}this._stop_updating_callback&&(a.defer(this._stop_updating_callback),this._stop_updating_callback=null);if(this._stop_updating)this._updating=this._stop_updating=!1;else if(this._updating){var c=this,
d={};this._update_opts.fetch_files&&(b=this.get_torrents_that_can_fetch_files(),0<b.length&&(d.hash=b));this._update_timeout=setTimeout(function(){var b={list:1,cid:c.torrent.cacheid};if(d.hash)b.action="getfiles";c.raptor.post(b,d,a.bind(c.do_update,c),a.bind(c.do_update_failed,c))},this._update_opts.delay)}},negotiate_session_key:function(b,c,d){this.negotiate_srp=new srp;var f={callback:a.bind(this.negotiated_session_key,this,d&&d.success),domain:config.srp_root,jsonp:config.toolbar};d&&d.error&&
(f.error=d.error);this.negotiate_srp.negotiate(d&&d.stay_signed_in,b,c,f)},negotiated_session_key:function(a,c,d){var f=new srp(c),f=new ClientAPI(f);f.client=this;this.raptor.api=f;d?(c={key:c,bt_talon_tkt:d.bt_talon_tkt,bt_user:d.bt_user,cid:d.cid},this.guid=d.GUID):(c={key:c,bt_talon_tkt:jQuery.cookie("bt_talon_tkt"),bt_user:jQuery.cookie("bt_user"),cid:jQuery.cookie("cid")},this.guid=jQuery.cookie("GUID"));client.type="remote";this.data=c;clients.add(this);this.manager.set_current_client(this.guid);
a&&(console.log("finished negotiating session key and client initialized. calling extra callback"),a(this))},connection_type:function(){if("remote"==this.type||this.guid||this.data&&this.data.guid)return"remote";if(this.raptor&&this.raptor.api.pairing)return"local";if(this.raptor){debugger;return null}return"direct"},add_unknown:function(b,c,d){if(23217<raptor.version)this.raptor.post({action:"add-unknown-url"},{s:b},c,d);else{if(!b.match(".rss$")){var f=parseUri(b).host,d=fjQuery.jStorage.get("cookies",
{});a.each(d,function(c,d){f.match(d+"$")==d&&(b+=":COOKIE:"+c,a.breakLoop())});this.torrent.add(b,c)}!b.match(".torrent$")&&!b.match("^magnet:")&&this.feed.add(b,c)}},get_everything:function(b){var c=this;if(this.everything_fetched)b();else{var d={timeout:3E4};console.log("fetching all torrents");this.torrent.all(function(){var f=a.filter(c.torrent.keys(),function(a){return!c.torrent.get(a).file.fetched});console.log("getting all (unfetched) files");c.raptor.post({action:"getfiles"},{hash:f},function(){console.log("getting all peers");
c.raptor.post({action:"getpeers"},{hash:c.torrent.keys()},function(){console.log("getting all settings");c.setting.all(function(){c.everything_fetched=!0;b&&b()})},d)},d)})}},get_all_files:function(b){var c={timeout:3E4},d=this;this.torrent.all(function(){a.filter(d.torrent.keys(),function(a){return!d.torrent.get(a).file.fetched});console.log("getting all files");d.raptor.post({action:"getfiles"},{hash:d.torrent.keys()},function(){b&&b()},c)})},get_all_peers:function(b){var c={timeout:3E4},d=this;
this.torrent.all(function(){a.filter(d.torrent.keys(),function(a){return!d.torrent.get(a).file.fetched});console.log("getting all peers");d.raptor.post({action:"getpeers"},{hash:d.torrent.keys()},function(){b&&b()},c)})},log:function(){"undefined"==typeof console||"undefined"==typeof console.log||(console.log.apply?console.log.apply(console,arguments):console.log(arguments[0],arguments[1],arguments[2],arguments[3]))},client_qs:function(){var a="GUID="+encodeURIComponent(this.guid)+"&bt_talon_tkt="+
encodeURIComponent(this.data.bt_talon_tkt);this.raptor_host&&(window.location.protocol+"//"+window.location.host!=this.raptor_host&&!1!==config.raptor_redirect&&(a=a+"&_rrendezvouz="+encodeURIComponent(this.raptor_host)),this.raptor.api.cipher.ivoffset&&this.raptor.api.jsonp&&(a=a+"&x_bt_seq="+this.raptor.api.cipher.ivoffset));return a},info:function(){var b={GUID:this.guid};a.extend(b,this.data);return jQuery.toJSON(b)},remove_from_stored_sessions:function(){var a=this.manager._store.get("falconStore.sessionKeys")||
{};a[this.guid]&&(delete a[this.guid],this.manager._store.set("falconStore.sessionKeys",a));a=jQuery.parseJSON(jQuery.cookie("sessions")||"{}");a[this.guid]&&delete a[this.guid];this.manager.save_sessions_cookie(a)},set_on_error:function(a){this._on_error=a},client_sent_error:function(a,c,d){"no client jsonp support"==d&&console.error("your client version has no jsonp support");if(config.asserts)debugger;this.remove_from_stored_sessions();this.cleanup();this._on_error?this._on_error(a,c,d):window.utweb&&
utweb.redirect_logout("Client sent error: "+a.status)},client_sent_unauthorized:function(){console.log("client sent 401 -- removing from stored sessions");this.remove_from_stored_sessions();this.cleanup()},token_decryption_failed:function(){console.log("token decryption failed -- :-( -- remove from stored sessions");this.remove_from_stored_sessions();this.cleanup()},serialize:function(a){var c={};if("remote"==this.connection_type()){var d=a.window_name||a.local_pairing?this.data.key:{u:this.data.bt_user,
c:this.data.cid,t:this.data.bt_talon_tkt};a.all&&(d.k=this.data.key);c[this.guid]=d}else if("local"==this.connection_type())this.raptor.api.pairing.foundport&&(c[this.raptor.api.pairing.pairing_key]={pairing_port:this.raptor.api.pairing.foundport});else{this.connection_type();debugger}return c},cleanup:function(){}}})(exports._);(function(a){if(!a||!a.toJSON&&!Object.toJSON&&!window.JSON)throw Error("jQuery, MooTools or Prototype needs to be loaded before jStorage!");a.jStorage={version:"0.1.2",_storage:{},_storage_service:{jStorage:"{}"},_storage_elm:null,json_encode:a.toJSON||Object.toJSON||window.JSON&&JSON.encode,json_decode:a.evalJSON||window.JSON&&JSON.decode||function(a){return(""+a).evalJSON()},_init:function(){var a;if("localStorage"in window)this._storage_service=window.localStorage;else if("globalStorage"in window)this._storage_service=
window.globalStorage[document.domain];else if(this._storage_elm=document.createElement("link"),"addBehavior"in this._storage_elm){this._storage_elm.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(this._storage_elm);this._storage_elm.load("jStorage");try{a=this._storage_elm.getAttribute("jStorage")}catch(b){a="{}"}a&&a.length&&(this._storage_service.jStorage=a)}else{this._storage_elm=null;return}if("jStorage"in this._storage_service&&this._storage_service.jStorage)try{this._storage=
this.json_decode(this._storage_service.jStorage)}catch(c){this._storage_service.jStorage="{}"}else this._storage_service.jStorage="{}"},_save:function(){if(this._storage_service){try{this._storage_service.jStorage=this.json_encode(this._storage)}catch(a){}if(this._storage_elm)try{this._storage_elm.setAttribute("jStorage",this._storage_service.jStorage),this._storage_elm.save("jStorage")}catch(b){}}},_checkKey:function(a){if(!a||"string"!=typeof a&&"number"!=typeof a)throw new TypeError("Key name must be string or numeric");
return!0},set:function(a,b){this._checkKey(a);this._storage[a]=b;this._save();return b},get:function(a,b){this._checkKey(a);return a in this._storage?this._storage[a]:b?b:null},deleteKey:function(a){this._checkKey(a);return a in this._storage?(delete this._storage[a],this._save(),!0):!1},flush:function(){this._storage={};this._save();return!0}};a.jStorage._init()})("undefined"!=typeof jQuery&&jQuery||$);jQuery.cookie=function(a,d,b){if("undefined"!=typeof d){b=b||{};null===d&&(d="",b.expires=-1);var c="";if(b.expires&&("number"==typeof b.expires||b.expires.toUTCString))"number"==typeof b.expires?(c=new Date,c.setTime(c.getTime()+864E5*b.expires)):c=b.expires,c="; expires="+c.toUTCString();var e=b.path?"; path="+b.path:"",f=b.domain?"; domain="+b.domain:"",b=b.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(d),c,e,f,b].join("")}else{d=null;if(document.cookie&&""!=document.cookie){b=
document.cookie.split(";");for(c=0;c<b.length;c++)if(e=jQuery.trim(b[c]),e.substring(0,a.length+1)==a+"="){d=decodeURIComponent(e.substring(a.length+1));break}}return d}};
