(function(e){e.Controller.include({isActive:function(){return this.active},activate:function(){this.active=!0;this.el.removeClass("hidden")},deactivate:function(){this.active=!1;this.el.addClass("hidden")}});e.ControllerWithManager=e.Controller.create({managed_controllers:[],active_controller:null,manage:function(){this.managed_controllers=arguments=Array.prototype.slice.call(arguments,0)},activateController:function(b){b=b?b:null;if(null!=b){if(0>this.managed_controllers.indexOf(b))throw"There's no controller `"+
b+"` being managed.";if(this[b].isActive())return}var a=this;_.each(this.managed_controllers,function(c){c==b?a[c].activate():a[c].deactivate()});this.active_controller=b},deactivateAll:function(){this.activateController(null)}})})(Spine,Spine.$);(function(e,b){window.TorrentItem=e.Controller.create({status_classes:"paused waiting checking downloading seeding done stopped error",init:function(){this.el=b('<div class="torrent" id="" data-label="" data-hash="" />');this.item.bind("update",this.proxy(this.render));this.item.bind("destroy",this.proxy(this.remove))},render:function(a){a&&(this.item=a);a=this.el.hasClass("slided");if(!a){var b=this.el.hasClass("selected"),d=this.el.hasClass("hidden");this.el.html(App.torrents.torrent_template(this.item)).removeClass(this.status_classes).addClass(this.item._torrent_class).attr("id",
"torrent_"+this.item.id).attr("data-percent",this.item.percent).attr("data-hash",this.item.id).attr("data-label",this.item.label);b&&(e.trigger("updateControls",this.item,"torrent"),e.trigger("updatePanel",this.item));this.el.toggleClass("selected",b).toggleClass("slided",a).toggleClass("hidden",d)}return this},remove:function(){this.el.remove()}});window.Torrents=e.Controller.create({events:{"swipeleft .torrent":"swiped","swiperight .torrent":"swiped","tap .torrent":"selected","tap .sub_labels a":"setLabel",
"tap .behind .labels":"showLabels","tap .behind .send_action":"sendAction","tap .behind a":"behindClick",tap:"deselectAll"},default_interval:3E3,interval:3E3,init:function(){this.filter_more=this.first_load=!1;this.content=this.el.find(".content:first");this.target_torrent=b('[data-target="torrent"]');this.total_download=b("#total_download");this.total_upload=b("#total_upload");this.labels_container=b("#sidebar").find(".labels > ul:first");this.torrents_filter_container=b("#sidebar").find(".torrents > ul:first");
e.bind("filterTorrents",this.proxy(this.filterList));e.bind("refreshAll",this.proxy(this.refreshAll));e.bind("setIntervals",this.proxy(this.setIntervals));Torrent.bind("refresh",this.proxy(this.addAll));Torrent.bind("create",this.proxy(this.addOne));this.torrent_template=Handlebars.compile(b("#tmpl_torrent").html());this.labels_template=Handlebars.compile(b("#tmpl_label").html());this.labels_menu_template=Handlebars.compile(b("#tmpl_labels_menu").html())},setIntervals:function(a){this.default_interval=
this.interval=1*a},activate:function(){this.active=!0;this.el.removeClass("hidden")},deactivate:function(){this.active=!1;this.deselectAll(!0);this.el.addClass("hidden");e.trigger("deactivatePanels")},afterUpdate:function(){var a=this;this.updateInterval=setTimeout(function(){a.refreshAll()},this.interval);this.refreshTotals();this.refreshSidebarCount();0>=Torrent.count()&&this.el.html('<div class="list_message"><p>Torrent list empty.</p></div>')},loadAll:function(){this.first_load=!0;var a=this;
this.el.addClass("loading");client.raptor.api.post({list:1},{},function(c){b("#all_content").addClass("content_loaded");a.content.html("");a.torrentc=c.torrentc;_.each(c.torrents,function(a){Torrent.smartInit(a).save()});a.processLabels(c.label,Torrent.count());e.trigger("processFeeds",c.rssfeeds);a.afterUpdate();a.el.removeClass("loading")},function(){a.interval*=1.5;a.updateInterval=setTimeout(function(){a.refreshAll()},a.interval)})},refreshAll:function(a,c){if(!this.torrentc)return!1;"remove"==
a&&(b("#torrent_"+c).hide(),e.trigger("updateControls"));var d=this;clearInterval(this.updateInterval);client.raptor.api.post({list:1,cid:this.torrentc,action:a,hash:c},{},function(a){d.interval=d.default_interval||3E3;d.torrentc=a.torrentc;d.processLabels(a.label,Torrent.count());a.torrentp&&a.torrentp.length>0&&_.each(a.torrentp,function(a){var a=Torrent.processAttributes(a),b;if(Torrent.exists(a.id)){b=Torrent.find(a.id);b.updateAttributes(a)}else{b=Torrent.init(a);b.save()}});a.torrentm&&a.torrentm.length>
0&&_.each(a.torrentm,function(a){Torrent.destroy(a)});e.trigger("processFeeds",a.rssfeedp,a.rssfeedm);d.filterList();d.afterUpdate()},function(){d.interval=d.interval*1.5;d.updateInterval=setTimeout(function(){d.refreshAll()},d.interval)})},filterList:function(a,b,d){a=a||this.filter_selector;b=void 0===b?this.filter_more:b;this.content.children(".hidden").removeClass("hidden");b&&this.content.children(a).removeClass("slided").addClass("hidden");d&&window.scrollability&&window.scrollability.scrollTo(this.content[0],
0,0,0);this.filter_selector=a;this.filter_more=b},refreshTotals:function(){var a=0,b=0;Torrent.each(function(d){a+=d.up_speed||0;b+=d.down_speed||0});this.total_download.html(App.parseBytes(b));this.total_upload.html(App.parseBytes(a))},refreshSidebarCount:function(){var a=this;this.torrents_filter_container.find("a").each(function(){var c=b(this).data("show"),c=a.content.children(c?c:null).length,d=b(this).find(".count");c?d.text(c).removeClass("hidden"):d.addClass("hidden")})},processLabels:function(a,
b){var d=this;if(!_.isEqual(a,this.labels)){var f="",e=this.labels_container.find(".current").data("label");_.each(a,function(a){f+=d.labels_template({name:a[0],count:a[1],show_count:!0,current:e==a[0]});b-=parseInt(a[1])});f=d.labels_template({no_label:!0,count:b,show_count:!0})+f;this.labels=a;this.labels_container.html(f)}},addAll:function(){Torrent.each(this.addOne)},addOne:function(a){this.content.append(TorrentItem.init({item:a}).render().el)},showLabels:function(a){a.preventDefault();var a=
b(a.currentTarget),c=a.siblings(".sub_labels"),d=[],f=c.data("current");c.hasClass("hidden")?(c.toggleClass("on_bottom",225>a.offset().top),_.each(this.labels,function(a){var b=a[0]==f;d.push({name:a[0],current:b,label:b?"":a[0]})}),c.html(this.labels_menu_template({labels:d})).removeClass("hidden")):c.addClass("hidden")},setLabel:function(a){a.preventDefault();var c=b(a.currentTarget),a=c.closest(".torrent"),d=a.find(".sub_labels"),c=c.data("label");switch(c){case "_new":c=prompt("Name the new label:")}d.addClass("hidden");
null!==c&&a.attr("data-label",c);a.removeClass("slided");null!==c&&client.raptor.api.post({action:"setprops",s:"label",hash:a.data("hash"),v:c})},sendAction:function(a){a.preventDefault();var a=b(a.currentTarget),c=a.closest(".torrent");e.trigger("refreshAll",a.data("action"),c.data("hash"));c.removeClass("slided")},behindClick:function(a){a.stopImmediatePropagation()},swiped:function(a){b(".slided",this.el).not(a.currentTarget).removeClass("slided");b(a.currentTarget).toggleClass("slided").find(".sub_labels").addClass("hidden")},
deselectAll:function(a){b("#search").blur();if(!0===a||this.el.get(0).id==a.target.id)b(this.el).find(".selected").removeClass("selected"),this.target_torrent.addClass("disabled"),e.trigger("closePanels"),this.current=""},selected:function(a){a.preventDefault();a=b(a.currentTarget);a.hasClass("slided")||(b(this.el).find(".selected, .slided").removeClass("selected slided"),a.addClass("selected"),this.target_torrent.removeClass("disabled"),this.current=a.data("hash"),a=Torrent.find(this.current),e.trigger("updatePanel",
a,!0),e.trigger("updateControls",a,"torrent"))}})})(Spine,Spine.$);(function(e,b){window.Controls=e.Controller.create({events:{"tap .buttons a":"buttonClicked","tap .popover > a":"popover","tap #app_title":"goHome","tap #options_toggle":"toggleSettings","tap #user_logout":"logoutUser"},init:function(){b("#search",this.el).bind("focus",this.proxy(this.searchFocused));b("#search",this.el).bind("blur",this.proxy(this.searchBlurred));this.target_torrent=b('[data-target="torrent"]');var a=this;e.bind("closeModals",this.proxy(function(){a.togglePopover(!1)}));e.bind("updateControls",
this.proxy(this.updateControls))},logoutUser:function(a){a=_.isString(a)?a:null;e.trigger("logoutUser",a)},toggleSettings:function(a){a.preventDefault();b("#body").removeClass("showmenu");e.trigger("toggleSettings")},goHome:function(a){a.preventDefault();b("#sidebar a:first").trigger("tap")},updateControls:function(a,b){if(a){var d=this.el.find(".controls_content:first");d.find('.buttons a:not([data-target="'+b+'"])').filter(':not([data-target="all"])').addClass("hidden");d.find('.buttons a[data-target="'+
b+'"]').removeClass("hidden disabled");0<=a._torrent_class.indexOf("waiting")?d.find('a[data-action="pause"], a[data-action="start"]').addClass("hidden"):0<=a._torrent_class.indexOf("paused")||0<=a._torrent_class.indexOf("stopped")?d.find('a[data-action="pause"], a[data-action="forcestart"]').addClass("hidden"):0<=a._torrent_class.indexOf("done")?d.find('a[data-action="pause"], a[data-action="forcestart"]').addClass("hidden"):d.find('a[data-action="forcestart"], a[data-action="start"]').addClass("hidden");
1>=a.queue_position&&d.find('a[data-action="queueup"]').addClass("disabled")}else this.target_torrent.addClass("disabled")},popover:function(a){a.preventDefault();b(a.currentTarget).closest(".popover").hasClass("open")||e.trigger("closeModals");this.togglePopover()},togglePopover:function(a){this.el.find(".popover").toggleClass("open",a)},buttonClicked:function(a){a.preventDefault();var a=b(a.currentTarget),c=a.data("action");if("torrent"==a.data("target")&&c)("remove"!=c||confirm("Are you sure you want to remove this torrent?"))&&
e.trigger("refreshAll",c,App.getSelected());else if("all"==a.data("target")&&c)switch(c){case "showmenu":b("#body").toggleClass("showmenu")}},searchFocused:function(){b(this.el).addClass("search_focused")},searchBlurred:function(){b(this.el).removeClass("search_focused")}})})(Spine,$);(function(e,b){window.Settings=e.Controller.create({elements:{"#top_settings":"top_element","#menu_settings":"menu_element","#inner_settings":"inner_menu_element",".title":"title_element",".title .text":"title_text_element"},events:{"tap #menu_settings a":"setCurrent","swipe .switch":"emulateChange","tap .go_back":"returnMenu","change #inner_settings input":"optionChanged","change #inner_settings textarea":"optionChanged","change #inner_settings select":"optionChanged"},init:function(){this.active=
this.first_load=!1;this.settings={};this.content=this.el.find(".content:first");this.all_content=b("#all_content");this.options_toggle=b("#options_toggle");this.go_back=this.el.find(".go_back");this.open_content_class="open_settings";this.templates={};var a=this;e.bind("closeModals",this.proxy(function(){a.toggleSettings(!1)}));e.bind("toggleSettings",this.proxy(this.toggleSettings));localStorage.getItem("use_compact")||localStorage.setItem("use_compact","false")},useWebUiSettings:function(){this.settings["webui._cookie.updateInterval"]&&
e.trigger("setIntervals",this.settings["webui._cookie.updateInterval"].value);var a=localStorage.getItem("use_compact");b("#torrents").toggleClass("compact",a&&"false"!==a)},optionChanged:function(a){var a=b(a.currentTarget),c=a.attr("name");if("local"==a.data("scope")){switch(a.attr("name")){case "multi_day_transfer_mode":var d,c=["multi_day_transfer_mode_ul","multi_day_transfer_mode_dl","multi_day_transfer_mode_uldl"];d=["0"==a.val()?1:0,"1"==a.val()?1:0,"2"==a.val()?1:0];for(var f=0;f<c.length;f++)this.settings[c[f]].value=
d[f];this.setSettings(c,d);break;case "use_compact":c=a.is(":checked"),localStorage.setItem("use_compact",""+c),b("#torrents").toggleClass("compact",c)}0<=a.attr("name").indexOf("webui.")&&(c=JSON.parse(this.settings["webui.cookie"].value),d=a.attr("name"),d=d.replace("webui._cookie.",""),c[d]=a.is(":checkbox")?a.is(":checked"):a.val(),this.settings["webui._cookie."+d].value=""+c[d],this.settings["webui.cookie"].value=JSON.stringify(c),this.setSettings("webui.cookie",this.settings["webui.cookie"].value))}else a.is(":checkbox")?
(value=a.is(":checked")?1:0,this.el.find('[data-depends="'+a.attr("id")+'"]').prop("disabled",!value),this.settings[c]&&(this.settings[c].value=""+!!value)):(value=a.val(),this.settings[c]&&(this.settings[c].value=value)),this.settings[c]&&this.setSettings(c,value)},setSettings:function(a,b){if(_.isArray(a)){for(var d="",f=0;f<a.length;f++)d.length&&(d+="&"),d+="s="+a[f]+"&v="+b[f];client.raptor.api.post("action=setsetting&"+d)}else client.raptor.api.post({action:"setsetting",s:a,v:b})},returnMenu:function(){this.el.find(".settings_content").removeClass("done");
this.el.removeClass("sub");this.title_text_element.text(this.title_element.data("title"));var a=this;this.cleaner_timeout=setTimeout(function(){a.inner_menu_element.html("")},300);window.scrollability&&window.scrollability.scrollTo(this.content[0],0,0,0)},startTemplates:function(){_.isEmpty(this.templates)&&(this.templates={section:Handlebars.compile(b("#tmpl_options_section").html())})},toggleSettings:function(a){void 0===a&&!this.active&&e.trigger("closeModals");this.activate(a);this.all_content.toggleClass(this.open_content_class,
this.active);this.returnMenu()},emulateChange:function(a){b(a.currentTarget).trigger("click")},setCurrent:function(a){a.preventDefault();clearTimeout(this.cleaner_timeout);this.startTemplates();var a=b(a.currentTarget),c=this,d="";_.each(window.options_map[a.data("content")].contents,function(a){d+=c.templates.section(a)});this.el.addClass("sub");this.inner_menu_element.html(d);this.title_text_element.text(a.text());this.setValues();window.scrollability&&window.scrollability.scrollTo(this.content[0],
0,0,0)},setValues:function(){var a=this;b("select, input, textarea",this.inner_menu_element).each(function(){var c=b(this),d=a.settings[c.attr("name")];if("local"==c.data("scope")&&!d)switch(c.attr("name")){case "use_compact":d=localStorage.getItem("use_compact");b("#use_compact").prop("checked",d&&"false"!=d).trigger("change");break;case "multi_day_transfer_mode":d="true"==a.settings.multi_day_transfer_mode_uldl.value?"2":"true"==a.settings.multi_day_transfer_mode_dl.value?"1":"0",b("#multi_day_transfer_mode").val(d)}else d&&
(c.is(":checkbox")?c.prop("checked","true"==d.value||"1"==d.value):c.val(d.value),0===d.type&&c.addClass("number"),"R"==d.access&&c.attr("disabled","disabled"));c.data("depends")&&c.prop("disabled",!b('[name="'+c.data("depends")+'"]',this.inner_menu_element).is(":checked"))})},activate:function(a){this.active=void 0===a?!this.all_content.hasClass(this.open_content_class):a;this.options_toggle.toggleClass("open",this.active);this.active&&this.loadAll()},loadAll:function(){this.first_load=!0;var a=
this;client.raptor.api.post({action:"getsettings"},{},function(b){_.each(b.settings,function(b){a.settings[b[0]]={type:b[1],value:b[2],access:b[3].access};"webui.cookie"==b[0]&&(b=JSON.parse(b[2]),_.each(b,function(b,c){a.settings["webui._cookie."+c]={type:!isNaN(b)?0:"true"==b&&"false"==b?1:2,value:""+b,access:"Y"}}))});a.useWebUiSettings()},function(a){console.log(a)})}});window.options_map={general:{name:"General",contents:{language:{title:"Language",elements:[{control_combo:!0,label_1:"Language:",
combo_1:{name:"webui.lang",contents:[{label:"English",value:"en"},{label:"Spanish",value:"es"}]}}]},privacy:{title:"Privacy",elements:[{control_checkbox:!0,label_1:"Check for updates",checkbox_1:"check_update"},{control_checkbox:!0,label_1:"Update to beta versions",checkbox_1:"check_update_beta"},{control_checkbox:!0,label_1:"Send anonymous information",checkbox_1:"anoninfo"}]},when_downloading:{title:"When Downloading",elements:[{control_checkbox:!0,label_1:"Append .!ut to imcomplete files",checkbox_1:"append_incomplete"},
{control_checkbox:!0,label_1:"Pre-allocate space for files",checkbox_1:"prealloc_space"},{control_checkbox:!0,label_1:"Prevent standby if there are active torrents",checkbox_1:"sys.prevent_standby"}]}}},ui_settings:{name:"UI Settings",contents:{display_local:{elements:[{control_checkbox:!0,label_1:"Compact View",checkbox_1:"use_compact",scope:"local"}]},display_options:{title:"Display Options",elements:[{control_checkbox:!0,label_1:"Confirm when deleting torrents",checkbox_1:"confirm_when_deleting"},
{control_checkbox:!0,label_1:"Confirm when deleting trackers",checkbox_1:"confirm_remove_tracker"},{control_checkbox:!0,label_1:"Show confirmation dialogs on exit",checkbox_1:"confirm_exit"},{control_checkbox:!0,label_1:"Alternate list background",checkbox_1:"gui.alternate_color"},{control_checkbox:!0,label_1:"Show current speed in the title bar",checkbox_1:"gui.speed_in_title"},{control_checkbox:!0,label_1:"Show speed limits in the status bar",checkbox_1:"gui.limits_in_statusbar"}]},when_adding_torrents:{title:"When Adding Torrents",
elements:[{control_checkbox:!0,label_1:"Don't start the download automatically",checkbox_1:"torrents_start_stopped"},{control_checkbox:!0,label_1:"Activate the program window",checkbox_1:"activate_on_file"},{control_checkbox:!0,label_1:"Show a window that displays the files inside the torrent",checkbox_1:"show_add_dialog"}]}}},directories:{name:"Directories",contents:{location_downloaded_files:{title:"Location of downloaded files",elements:[{control_checkbox_textbox:!0,checkbox_1:"dir_active_download_flag",
label_1:"Put new downloads in:",textbox_1:"dir_active_download"},{control_checkbox:!0,label_1:"Always show dialog in manual add",checkbox_1:"always_show_add_dialog"},{control_checkbox_textbox:!0,checkbox_1:"dir_completed_download_flag",label_1:"Move completed downloads to:",textbox_1:"dir_completed_download"},{control_checkbox:!0,label_1:"Append the torrent's label",checkbox_1:"dir_add_label"},{control_checkbox:!0,label_1:"Only move from the default download directory",checkbox_1:"move_if_defdir"}]},
location_torrents:{title:"Location of torrents",elements:[{control_checkbox_textbox:!0,checkbox_1:"dir_torrent_files_flag",label_1:"Store .torrents in:",textbox_1:"dir_torrent_files"},{control_checkbox_textbox:!0,checkbox_1:"dir_completed_torrents_flag",label_1:"Move .torrents for finished jobs to:",textbox_1:"dir_completed_torrents"},{control_checkbox_textbox:!0,checkbox_1:"dir_autoload_flag",label_1:"Automatically load .torrents from:",textbox_1:"dir_autoload"},{control_checkbox:!0,label_1:"Delete loaded .torrents",
checkbox_1:"dir_autoload_delete"}]}}},connection:{name:"Connection",contents:{listening_port:{title:"Listening port",elements:[{control_textbox:!0,label_1:"Port used for incoming connections:",textbox_1:"bind_port"},{control_checkbox:!0,label_1:"Enable UPnP portmapping",checkbox_1:"upnp"},{control_checkbox:!0,label_1:"Randomize port on each start",checkbox_1:"rand_port_on_start"},{control_checkbox:!0,label_1:"Enable NAT-PMP portmapping",checkbox_1:"natpmp"},{control_checkbox:!0,label_1:"Add Windows Firewall exception",
checkbox_1:"disable_fw"}]},proxy_server:{title:"Proxy Server",elements:[{control_combo:!0,label_1:"Type:",combo_1:{name:"proxy.type",contents:[{label:"(none)",value:"0"},{label:"Socks4",value:"1"},{label:"Socks5",value:"2"},{label:"HTTPS",value:"3"},{label:"HTTP",value:"4"}]}},{control_textbox_large:!0,label_1:"Proxy:",checkbox_1:"proxy.proxy"},{control_textbox:!0,label_1:"Port:",checkbox_1:"proxy.port"},{control_checkbox:!0,label_1:"Authentication",checkbox_1:"proxy.auth"},{control_textbox:!0,label_1:"Username:",
checkbox_1:"proxy.username",depends:"proxy.auth"},{control_password:!0,label_1:"Password:",checkbox_1:"proxy.password",depends:"proxy.auth"},{control_checkbox:!0,label_1:"Resolve hostnames through proxy:",checkbox_1:"proxy.resolve"},{control_checkbox:!0,label_1:"Use proxy server for peer-to-peer connections",checkbox_1:"proxy.p2p"}]},proxy_privacy:{title:"Proxy Privacy",elements:[{control_checkbox:!0,label_1:"Disable all local DNS lookups:",checkbox_1:"no_local_dns"},{control_checkbox:!0,label_1:"Disable features that leak identifying information",
checkbox_1:"private_ip"},{control_checkbox:!0,label_1:"Disable connections unsupported by the proxy",checkbox_1:"only_proxied_conns"}]}}},bandwidth:{name:"Bandwidth",contents:{upload_rate_limiting:{title:"Global Upload Rate Limiting",elements:[{control_textbox:!0,label_1:"Maximum upload rate (kB/s): [0: unlimited]",textbox_1:"max_ul_rate"},{control_checkbox_textbox:!0,label_1:"Alternate upload rate when not downloading (kB/s):",checkbox_1:"max_ul_rate_seed_flag",textbox_1:"max_ul_rate_seed"}]},download_rate_limiting:{title:"Global Download Rate Limiting",
elements:[{control_textbox:!0,label_1:"Maximum download rate (kB/s): [0: unlimited]",textbox_1:"max_dl_rate"}]},rate_limit:{title:"Global Rate Limit Options",elements:[{control_checkbox:!0,label_1:"Apply rate limit to transport overhead",checkbox_1:"net.calc_overhead"},{control_checkbox:!0,label_1:"Apply rate limit to uTP connections",checkbox_1:"net.ratelimit_utp"}]},number_connections:{title:"Number of Connections",elements:[{control_textbox:!0,label_1:"Global maximum number of connections:",textbox_1:"conns_globally"},
{control_textbox:!0,label_1:"Maximum number of connected peers per torrent:",textbox_1:"conns_per_torrent"},{control_textbox:!0,label_1:"Number of upload slots per torrent:",textbox_1:"ul_slots_per_torrent"}]}}},bittorrent:{name:"BitTorrent",contents:{basic_bt:{title:"Basic BitTorrent Features",elements:[{control_checkbox:!0,label_1:"Enable DHT Network",checkbox_1:"dht"},{control_checkbox:!0,label_1:"Enable DHT for new torrents",checkbox_1:"dht_per_torrent"},{control_checkbox:!0,label_1:"Enable Local Peer Discovery",
checkbox_1:"lsd"},{control_checkbox:!0,label_1:"Enable bandwidth management [uTP]",checkbox_1:"enable_bw_management"},{control_checkbox:!0,label_1:"Ask tracker for scrape information",checkbox_1:"enable_scrape"},{control_checkbox:!0,label_1:"Enable Peer Exchange",checkbox_1:"pex"},{control_checkbox:!0,label_1:"Limit local peer bandwidth",checkbox_1:"rate_limit_local_peers"},{control_checkbox:!0,label_1:"Enable UDP tracker support",checkbox_1:"use_udp_trackers"},{control_textbox_large:!0,label_1:"IP/Hostname to report to tracker:",
textbox_1:"tracker_ip"}]},protocol_encryption:{title:"Protocol Encryption",elements:[{control_combo:!0,label_1:"Outgoing:",combo_1:{name:"encryption_mode",contents:[{label:"Disabled",value:"0"},{label:"Enabled",value:"1"},{label:"Forced",value:"2"}]}},{control_checkbox:!0,label_1:"Allow incoming legacy connections",checkbox_1:"encryption_allow_legacy"}]}}},transfer_cap:{name:"Transfer Cap",contents:{enable_transfer_cap:{elements:[{control_checkbox:!0,label_1:"Enable Transfer Cap",checkbox_1:"multi_day_transfer_limit_en"}]},
cap_settings:{title:"Cap Settings",elements:[{control_combo:!0,label_1:"Limit Type:",scope:"local",combo_1:{name:"multi_day_transfer_mode",contents:[{label:"Uploads",value:"0"},{label:"Downloads",value:"1"},{label:"Uploads + Downloads",value:"2"}]},depends:"multi_day_transfer_limit_en"},{control_textbox:!0,label_1:"Bandwidth Cap (Value):",textbox_1:"multi_day_transfer_limit_value",depends:"multi_day_transfer_limit_en"},{control_combo:!0,label_1:"Bandwidth Cap (Units):",combo_1:{name:"multi_day_transfer_limit_unit",
contents:[{label:"MB",value:"0"},{label:"GB",value:"1"}]},depends:"multi_day_transfer_limit_en"},{control_combo:!0,label_1:"Time Period (Days):",combo_1:{name:"multi_day_transfer_limit_span",contents:[{label:"1",value:"0"},{label:"2",value:"1"},{label:"5",value:"2"},{label:"7",value:"3"},{label:"10",value:"4"},{label:"14",value:"5"},{label:"15",value:"6"},{label:"20",value:"7"},{label:"21",value:"8"},{label:"28",value:"9"},{label:"30",value:"10"},{label:"31",value:"11"}]},depends:"multi_day_transfer_limit_en"}]}}},
queuing:{name:"Queuing",contents:{queue_settings:{title:"Queue Settings",elements:[{control_textbox:!0,label_1:"Maximum number of active torrents (upload or download):",textbox_1:"max_active_torrent"},{control_textbox:!0,label_1:"Maximum number of active downloads:",textbox_1:"max_active_downloads"}]},seed_while:{title:"Seed While [Default values]",elements:[{control_textbox:!0,label_1:"Minimum ratio (%):",textbox_1:"seed_ratio"},{control_textbox:!0,label_1:"Minimum seeding time (minutes):",textbox_1:"seed_time"},
{control_checkbox:!0,label_1:"Seeding tasks have higher priority than downloading tasks",checkbox_1:"seeds_prioritized"}]},when_ut_reaches_seeding:{title:"Global Rate Limit Options",elements:[{control_checkbox_textbox:!0,label_1:"Limit the upload rate to (kB/s): [0: stop]",checkbox_1:"seed_prio_limitul_flag",textbox_1:"seed_prio_limitul"}]}}},scheduler:{name:"Scheduler",contents:{scheduler_settings:{title:"Scheduler Settings",elements:[{control_checkbox:!0,label_1:"Enable Scheduler:",checkbox_1:"sched_enable"},
{control_textbox:!0,label_1:"Limit upload rate (kB/s):",textbox_1:"sched_ul_rate"},{control_textbox:!0,label_1:"Limit download rate (kB/s):",textbox_1:"sched_dl_rate"},{control_checkbox:!0,label_1:"Disable DHT when turning off:",checkbox_1:"sched_dis_dht"}]}}},web_ui:{name:"Web UI",contents:{enable_web_ui:{elements:[{control_checkbox:!0,label_1:"Enable Web UI",checkbox_1:"webui.enable"}]},authentication:{title:"Authentication",elements:[{control_textbox:!0,label_1:"Username:",textbox_1:"webui.username"},
{control_password:!0,label_1:"Password:",password_1:"webui.password"},{control_checkbox_textbox:!0,label_1:"Enable Guest account with username:",checkbox_1:"webui.enable_guest",textbox_1:"webui.guest"}]},connectivity:{title:"Connectivity",elements:[{control_checkbox_textbox:!0,label_1:"Alternative listening port (default is the connection port):",checkbox_1:"webui.enable_listen",textbox_1:"webui.port"},{control_textbox_large:!0,label_1:"Allow access only from these IPs (separate multiple entries with comma):",
textbox_1:"webui.restrict"}]},user_interface:{title:"User Interface",elements:[{control_checkbox:!0,label_1:"Show Toolbar",checkbox_1:"webui._cookie.showToolbar",scope:"local"},{control_checkbox:!0,label_1:"Show Category List",checkbox_1:"webui._cookie.showCategories",scope:"local"},{control_checkbox:!0,label_1:"Show Detailed Info",checkbox_1:"webui._cookie.showDetails",scope:"local"},{control_checkbox:!0,label_1:"Show Status Bar",checkbox_1:"webui._cookie.showStatusBar",scope:"local"},{control_textbox:!0,
label_1:"Update GUI every(ms):",textbox_1:"webui._cookie.updateInterval",scope:"local"},{control_textbox:!0,label_1:"Max. rows per page:",textbox_1:"webui._cookie.maxRows",scope:"local"},{control_checkbox:!0,label_1:"Use system fonts",checkbox_1:"webui._cookie.useSysFont",scope:"local"}]}}},ui_extras:{name:"UI Extras",contents:{persistent_labels:{title:"Persistent Labels",elements:[{control_textbox_large:!0,label_1:"Separate multiple labels with | character:",textbox_1:"gui.persistent_labels"}]},
search_engines:{title:"Search Engines",elements:[{control_textarea:!0,label_1:"Format: name|URL",textarea_1:"search_list"}]}}},disk_cache:{name:"Disk Cache",contents:{basic_cache_settings:{title:"Basic Cache Settings",elements:[{control_html:!0,html:"<p>The disk cache is used to keep frequently accessed data in memory to reduce the number of reads and writes to the hard drive. &micro;Torrent normally manages the cache automatically, but you may change its behavior by modifying these settings.</p>"},
{control_checkbox_textbox:!0,label_1:"Override automatic cache size and specify the size manually (MB):",checkbox_1:"cache.override",textbox_1:"cache.override_size"},{control_checkbox:!0,label_1:"Reduce memory usage when the cache is not needed",checkbox_1:"cache.reduce"}]},advanced_cache_settings:{title:"Advanced Cache Settings",elements:[{control_checkbox:!0,label_1:"Enable caching of disk writes",checkbox_1:"cache.write"},{control_checkbox:!0,label_1:"Write out untouched blocks every 2 minutes",
checkbox_1:"cache.writeout",depends:"cache.write"},{control_checkbox:!0,label_1:"Write out finished pieces immediately",checkbox_1:"cache.writeimm",depends:"cache.write"},{control_checkbox:!0,label_1:"Enable caching of disk reads",checkbox_1:"cache.read"},{control_checkbox:!0,label_1:"Turn off read caching if the upload speed is slow",checkbox_1:"cache.read_turnoff",depends:"cache.read"},{control_checkbox:!0,label_1:"Remove old blocks from the cache",checkbox_1:"cache.read_prune",depends:"cache.read"},
{control_checkbox:!0,label_1:"Increase automatic cache size when cache thrashing",checkbox_1:"cache.read_thrash",depends:"cache.read"},{control_checkbox:!0,label_1:"Disable Windows caching of disk writes",checkbox_1:"cache.disable_win_write"},{control_checkbox:!0,label_1:"Disable Windows caching of disk reads",checkbox_1:"cache.disable_win_read"}]}}},run_program:{name:"Run Program",contents:{run_program:{title:"Run Program",elements:[{control_textbox_large:!0,label_1:"Run this program when a torrent finishes:",
textbox_1:"finish_cmd"},{control_textbox_large:!0,label_1:"Run this program when a torrent changes state:",textbox_1:"state_cmd"},{control_html:!0,html:"<p>You can use these commands:<br />%F - Name of downloaded file (for single file torrents)<br />%D - Directory where files are saved<br />%N - Title of torrent<br />%S - State of torrent<br />%L - Label<br />%T - Tracker<br />%M - Status message string (same as status column)<br />%I - hex encoded info-hash<br /><br />State is a combination of:<br />started = 1, checking = 2, start-after-check = 4,<br />checked = 8, error = 16, paused = 32, auto = 64, loaded = 128</p>"}]}}},
about:{name:"About",contents:{info:{title:"Information",elements:[{control_html:!0,html:"<p>Copyright &copy; "+(new Date).getFullYear()+"<br />BitTorrent Inc.<br />All Rights Reserved.</p><p>Remote Touch UI, Version: "+app_version+"</p>"},{control_html:1,html:'<p><a class="open_sessions">Click here to manage sessions.</a></p>'}]}}}}})(Spine,Spine.$);(function(e,b){PanelDynamic=e.Controller.create({init:function(){this.active=!1;this.template=Handlebars.compile(b(this.template).html());this.container=this.el.find(".content:first")},activate:function(){this.active=!0;this.el.removeClass("hidden");this.loadAll(!0)},deactivate:function(){this.active=!1;this.el.addClass("hidden");clearTimeout(this.updateInterval);this.model.deleteAll()},loadAll:function(a){if(this.active){this.model.deleteAll();a&&this.el.addClass("loading");var b=this;clearTimeout(this.updateInterval);
client.raptor.api.post({action:this.action,hash:window.App.getSelected()},{},function(a){var f;_.each(a[b.result_property][1],function(a,d){f=b.model.smartInit(a,d);f.save()});b.render();b.updateInterval=setTimeout(function(){b.loadAll()},b.interval);b.el.removeClass("loading")})}},render:function(){this.container.html(this.template({items:this.model.all()}))}});window.Files=PanelDynamic.create();window.Peers=PanelDynamic.create();window.Speed=e.Controller.create({el:b("#subpanel_speed"),canvas:b("#speed_canvas"),
init:function(){this.plot_options={colors:["#009900","#1C8DFF"],series:{shadowSize:0},yaxis:{min:0,minTickSize:5120,tickFormatter:function(a){return App.parseBytes(a)+"/s"}},xaxis:{mode:"time",timeformat:"%H:%M:%S"}}},activate:function(){this.active=!0;this.el.removeClass("hidden");if(b.plot)this.loadPlot();else{var a=this;this.el.addClass("loading");$LAB.script("js/vendor/jquery.flot.min.js").wait(function(){b(a.el).removeClass("loading");a.loadPlot()})}},loadPlot:function(){var a=new Date,a=a.getTime()-
6E4*a.getTimezoneOffset();this.plot=b.plot(this.canvas,[{label:"down speed",data:[[a,0]]},{label:"up speed",data:[[a,0]]}],this.plot_options);this.updateCanvas()},deactivate:function(){this.active=!1;this.el.addClass("hidden");this.plot&&this.plot.shutdown();this.plot=null},updateCanvas:function(a){if(this.active){var a=a?a:[],b=[],d=[];480>=screen.width&&(a=_.last(a,8));_.each(a,function(a){b.push([a.time,a.up]);d.push([a.time,a.down])});this.plot.resize();this.plot.setData([{label:"down speed",
data:d},{label:"up speed",data:b}]);this.plot.setupGrid();this.plot.draw()}}});window.Info=e.Controller.create({el:b("#subpanel_info")});window.Panels=e.ControllerWithManager.create({events:{"tap .tabs a":"toggleOpen","click #close_panels":"close","tap .panel header li a":"changePaneContent","tap .priority li":"setPriority","change .checkbox":"setDownload"},init:function(){e.bind("updatePanel",this.proxy(this.updatePanel));this.files=Files.init({el:b("#subpanel_files"),template:"#tmpl_subpanel_files",
action:"getfiles",result_property:"files",model:window.File,interval:6E3,active:!1});this.peers=Peers.init({el:b("#subpanel_peers"),template:"#tmpl_subpanel_peers",action:"getpeers",result_property:"peers",model:window.Peer,interval:6E3,active:!1});e.bind("closePanels",this.proxy(this.close));this.speed=Speed.init({active:!1});this.info=Info.init({active:!1});e.bind("setIntervals",this.proxy(this.setIntervals));this.info_template=Handlebars.compile(b("#tmpl_subpanel_info").html());this.manage("files",
"info","peers","speed")},setIntervals:function(a){this.peers.interval=2*a;this.files.interval=2*a},setDownload:function(a){var c=b(a.target),a=c.closest("li[data-id]"),d=a.find(".priority:first"),c=1==c.attr("data-value")?File.priorities.indexOf("normal"):0;d.removeClass("low normal high");c&&d.addClass("normal");this.setFilePriority(a.data("id"),c)},setPriority:function(a){var c=b(a.target),d=c.closest("li[data-id]"),a=d.find(".priority:first"),d=d.find(".checkbox:first"),c=c.attr("class");d.attr("data-value",
1);a.removeClass("low normal high").addClass(c);this.setFilePriority(a.closest("li").data("id"),File.priorities.indexOf(c))},setFilePriority:function(a,b){client.raptor.api.post({action:"setprio",f:a,p:b,hash:App.getSelected()},{hash:App.getSelected()})},changePaneContent:function(a){a.preventDefault();var a=b(a.currentTarget),c=a.attr("href");a.closest("ul").find(".current").removeClass("current");a.addClass("current");this.activateController(c.replace("#subpanel_",""))},updatePanel:function(a,c){b("#subpanel_info").find(".content").html(this.info_template(a));
this.speed.updateCanvas(a._speed_history);c&&(this.files.loadAll(!0),this.peers.loadAll(!0))},close:function(){b("#torrents").removeClass("panel_open");b(this.el).removeClass("open");b(".tabs a",this.el).removeClass("current");this.deactivateAll()},toggleOpen:function(a){a.preventDefault();a=b(a.currentTarget);a.hasClass("current")?this.close():(b(this.el).find(".panel").addClass("hidden").filter("."+a.data("content")).removeClass("hidden"),b(".tabs a",this.el).removeClass("current"),!b(this.el).hasClass("open")&&
b(this.el).find(".current").length&&(b("#torrents").addClass("panel_open"),b(this.el).addClass("open")),b(".panel header .current",this.el).trigger("tap"),b(this.el).hasClass("open")&&a.addClass("current"))}})})(Spine,Spine.$);(function(e,b){window.Feeds=e.Controller.create({events:{"tap .download":"download"},interval:2E3,init:function(){this.content=this.el.find(".content:first");this.template=Handlebars.compile(b("#tmpl_feeds").html());this.sb_feeds_template=Handlebars.compile(b("#tmpl_label_feed").html());this.sb_feeds_container=b("#sidebar").find(".feeds > ul:first");e.bind("processFeeds",this.proxy(this.processFeeds));e.bind("filterFeeds",this.proxy(this.filterFeeds))},download:function(a){a.preventDefault();var c=
b(a.currentTarget),a=c.closest(".feedtorrent").data("feed");c.addClass("loading");c.html("");client.raptor.api.post({action:c.data("action"),feedid:a},{s:c.data("url")},function(){c.addClass("added");c.text("Sent");c.closest(".controls").addClass("in_history");c.removeClass("loading")})},filterFeeds:function(a){var b;0>a?b=this.el.find(".feedtorrent"):(a="_last"==a&&this.last_feed_id?this.last_feed_id:a,b=this.el.find('.feedtorrent[data-feed="'+a+'"]'),this.el.find('.feedtorrent:not([data-feed="'+
a+'"])').addClass("hidden"));b.removeClass("hidden");this.el.find(".list_message").toggleClass("hidden",0<b.length);window.scrollability&&window.scrollability.scrollTo(this.content[0],0,0,0);this.last_feed_id=a},processFeeds:function(a,b){this.addFeeds(a||[]);this.deleteFeeds(b||[]);(a&&a.length||b&&b.length)&&this.render()},addFeeds:function(a){var b;_.each(a,function(a){if(Feed.exists(a[0])){var e=FeedTorrent.findAllByAttribute("feed_id",a[0]);_.each(e,function(a){FeedTorrent.destroy(a.id)});Feed.smartUpdate(a[0],
a)}else b=Feed.smartInit(a),b.save()})},deleteFeeds:function(a){_.each(a,function(a){Feed.destroy(a)})},render:function(){var a=this.sb_feeds_template({items:{no_feed:!0,id:-1}}),c=b(".current",this.sb_feeds_container);Feed.each(function(a){a.updateAttribute("_current",c.length&&c.data("feed")==a.id)});this.sb_feeds_container.html(a+this.sb_feeds_template({items:Feed.all()}));this.content.html(this.template({items:FeedTorrent.all()}));this.filterFeeds("_last")}})})(Spine,$);(function(e,b){window.Sidebar=e.Controller.create({events:{"tap li a":"setCurrent","tap .torrents a":"torrentView","tap .labels a":"filterLabel","tap .feed a":"showFeed","tap .apps a":"showApp","tap section h2.collapsable":"collapseSection"},init:function(){this.torrents=b("#torrents");this.torrents_container=this.torrents.find(".content:first");this.el_footer=b("#sidebar_footer");this.popover_element=b(".popover",this.el_footer);this.adder_title=this.el_footer.find(".title");this.settings=JSON.parse(localStorage.getItem("sections"));
this.popover_element.find("> a").bind("tap",this.proxy(this.popover));this.popover_element.find(".go_back").bind("click",this.proxy(this.returnMenu));this.popover_element.find("ul a").bind("tap",this.proxy(this.showAdder));this.popover_element.find("form").bind("submit",this.proxy(this.addUrl));var a=this;e.bind("closeModals",this.proxy(function(){a.togglePopover(!1)}));this.settings?(a=this,_.each(this.settings,function(b,d){a.el.find("section."+d).addClass(b.collapsed?"collapsed":"")})):(localStorage.setItem("sections",
JSON.stringify({torrents:{collapsed:!1},labels:{collapsed:!1},feeds:{collapsed:!1},apps:{collapsed:!1}})),this.settings=JSON.parse(localStorage.getItem("sections")))},returnMenu:function(){b(".go_back",this.el_footer).addClass("hidden");b(".options",this.el_footer).removeClass("extra");this.adder_title.text(this.adder_title.data("title"))},showAdder:function(a){a.preventDefault();a=b(a.currentTarget);b(".go_back",this.el_footer).removeClass("hidden");this.adder_title.text(a.data("title"));b(".options",
this.el_footer).addClass("extra");b(".extra_options",this.el_footer).children(".option").addClass("hidden").filter("."+a.data("target")).removeClass("hidden").focus()},popover:function(a){a.preventDefault();console.log(this);this.popover_element.hasClass("open")||e.trigger("closeModals");this.togglePopover()},togglePopover:function(a){this.returnMenu();this.popover_element.toggleClass("open",a)},addUrl:function(a){a.preventDefault();var c=b(a.currentTarget).find("button:first"),d=b("#"+c.data("url-element")),
a=d.val(),e=this;!a||d[0].validity&&!d[0].validity.valid?(alert("You need to insert a valid URL"),d.focus()):(c.addClass("loading"),client.raptor.api.post({action:c.data("action")},{url:a},function(){e.popover_element.removeClass("open");e.el_footer.find(".extra").removeClass("extra");d.val("");c.removeClass("loading")}))},setCurrent:function(a){b("#body").removeClass("showmenu");b(a.currentTarget).closest("#sidebar").find(".current").removeClass("current");b(a.currentTarget).addClass("current")},
collapseSection:function(a){a=b(a.currentTarget).closest("section");a.toggleClass("collapsed");this.settings[a.data("section")].collapsed=a.hasClass("collapsed");localStorage.setItem("sections",JSON.stringify(this.settings))},torrentView:function(a){a.preventDefault();a=b(a.currentTarget).data("show");e.trigger("filterTorrents",".torrent:not("+a+")",a,!0);e.trigger("activateController","torrents")},filterLabel:function(a){a.preventDefault();a=b(a.currentTarget).data("label");e.trigger("filterTorrents",
".torrent:not([data-label='"+a+"'])",!0);e.trigger("activateController","torrents")},showFeed:function(a){a.preventDefault();e.trigger("activateController","feeds");e.trigger("filterFeeds",b(a.currentTarget).data("feed"))},showApp:function(a){a.preventDefault()}})})(Spine,Spine.$);(function(e){window.Torrent=e.Model.setup("Torrent","id status name size percent downloaded uploaded ratio up_speed down_speed eta label peers_connected peers_swarm seeds_connected seeds_swarm availability queue_position remaining download_url rss_feed_url message stream_id added_on completed_on app_update_url directory webseed_enabled _status_byline _compact_byline _torrent_class _speed_history".split(" "));window.Torrent.extend({bits:"started;checking;start after check;checked;error;paused;queued;loaded".split(";"),
max_speed_history:25,speed_history:[],smartInit:function(b){b=this.processAttributes(b);480>=screen.width&&(this.max_speed_history=5);return this.init(b)},processAttributes:function(b){var a={},c=0;_.each(this.attributes,function(d){a[d]=b[c++]||void 0});return a=this.processData(a)},processData:function(b){b.ratio=b.ratio?(b.ratio/1E3).toFixed(2):0;b.percent=b.percent?b.percent/10:0;b.peers_connected=b.peers_connected?b.peers_connected:0;b.seeds_connected=b.seeds_connected?b.seeds_connected:0;b.availability=
(b.availability/65535).toFixed(2);b._speed_history=this.speedHistory(b.id,b.up_speed,b.down_speed);b.statuses=this.mapStatuses(b.status);return b=this.processStatus(b)},speedHistory:function(b,a,c){var d=new Date,d=d.getTime()-6E4*d.getTimezoneOffset();if(!this.speed_history[b]){this.speed_history[b]=[];var e=d-1E3*this.max_speed_history;for(i=0;i++<this.max_speed_history;)this.speed_history[b].push({up:null,down:null,time:e+1E3*i})}this.speed_history[b].push({up:a||0,down:c||0,time:d});this.speed_history[b].length>
this.max_speed_history&&this.speed_history[b].shift();return this.speed_history[b]},mapStatuses:function(b){var a=[];_.map(this.bits,function(c,d){Math.pow(2,d)&b&&a.push(c)});return a},processStatus:function(b){var a=100<=b.percent,c=b.percent,d=!_.contains(b.statuses,"queued")&&_.contains(b.statuses,"started"),e,g;_.contains(b.statuses,"paused")&&(e="Paused",g="paused");_.contains(b.statuses,"checking")&&(e="Checked %:.1d%%".replace(/%:\.1d%/,(c/10).toFixed(1)),g="checking waiting");!e&&a?_.contains(b.statuses,
"queued")?_.contains(b.statuses,"started")?(e="Seeding to "+(b.peers_connected||0)+" peers",e+=" - U: "+App.parseBytes(b.up_speed)+"/s",e+=" ETA: "+App.secondsToString(b.eta),g="seeding"):(e="Queued Seed",g="seeding waiting"):(e="Finished",g="done"):e||(_.contains(b.statuses,"queued")&&!_.contains(b.statuses,"started")?(e="Queued, position: "+b.queue_position,g="waiting"):!_.contains(b.statuses,"queued")&&!_.contains(b.statuses,"started")?(e="Stopped "+c/10+"%",g="stopped"):(e=(d?"[F] ":"")+("Downloading from "+
(b.seeds_connected||0)+" peers"),e+=" - D: "+App.parseBytes(b.down_speed)+"/s U: "+App.parseBytes(b.up_speed)+"/s",e+=" ETA: "+App.secondsToString(b.eta),g="downloading"));a=e.split(" - ");b._torrent_class=g;b._status_byline=e;b._compact_byline=1<a.length?a[1]:e;return b}})})(Spine,Spine.$);(function(e){window.File=e.Model.setup("File","name size downloaded priority first_piece num_pieces streamable encoded_rate duration width height stream_eta streamability _checkbox_value _priority_class _percent".split(" "));window.File.extend({priorities:["none","low","normal","high"],smartInit:function(b,a){var c={},d=0;_.each(this.attributes,function(a){c[a]=b[d++]});c.id=""+a;c._priority_class=this.priorities[c.priority];c._checkbox_value=0<c.priority?1:0;c._percent=(100*(c.downloaded/c.size)).toFixed(0);
return this.init(c)}})})(Spine,Spine.$);(function(e){window.Peer=e.Model.setup("Peer","country ip hostname protocol port client flags complete down_speed up_speed pending requests waited uploaded downloaded hasherr peer_download_rate maxup maxdown queued inactive relevance".split(" "));window.Peer.extend({smartInit:function(b,a){var c={},d=0;c.id=a;_.each(this.attributes,function(a){c[a]=b[d++]});c.complete/=10;return this.init(c)}})})(Spine,Spine.$);(function(e){window.Feed=e.Model.setup("Feed","id enabled usefeedtitle user_selected programmed download_state url next_update items _count _show_count _name _url _current".split(" "));window.Feed.extend({smartInit:function(b){return this.init(this.processAttributes(b))},smartUpdate:function(b,a){var c=this.processAttributes(a);return this.update(b,c)},processAttributes:function(b){var a={},c=0;_.each(this.attributes,function(d){a[d]=b[c++]||void 0});return a=this.processData(a)},processData:function(b){b._count=
b.items.length;b._show_count=!!b._count;var a=b.url.split("|");b._url=a[1];b._name=a[0];var c;_.each(b.items,function(a){c=FeedTorrent.smartInit(a);c.save()});return b}})})(Spine,Spine.$);(function(e){window.FeedTorrent=e.Model.setup("Feed","name name_full url quality codec timestamp season episode episode_to feed_id repack in_history torrent".split(" "));window.FeedTorrent.extend({smartInit:function(b){return this.init(this.processAttributes(b))},processAttributes:function(b){var a={},c=0;_.each(this.attributes,function(d){a[d]=b[c++]||void 0});return a=this.processData(a)},processData:function(b){return b}})})(Spine,Spine.$);(function(e,b){b("#body").removeClass("waiting");b(".app_version").text(app_version);setTimeout(function(){b("#waiting_logo, #waiting_loader").remove()},300);b.support.touch?$LAB.script("js/vendor/scrollability.min.js"):b(".scrollable").removeClass("scrollable").parent().addClass("scrollable desktop");b(".checkbox").live("tap",function(){b(this).attr("data-value",1==b(this).attr("data-value")?0:1);b(this).trigger("change")});(0<window.location.href.indexOf("bittorrent.com")||0<window.location.href.indexOf("bittorrent"))&&
b("#bt_branding").attr("rel","stylesheet");window.uTorrentApp=e.ControllerWithManager.create({el:"body",events:{"tap .popover, #options, #options_toggle":"stopPropagation"},elements:{"#sidebar":"sidebar_element","#torrents":"torrents_element","#feeds":"feeds_element","#panels":"panel_element","#controls_main":"controls_element","#options":"settings_element"},stopPropagation:function(a){a.stopImmediatePropagation()},init:function(){this.token_tries=3;this.url="/gui/";window.clients=new ClientManager;
clients.sync();clients.set_current_client();(this.client=clients.get_current_client())?b(".current_user").text(this.client.data.bt_user):this.logoutUser("Please log in");this.torrents=Torrents.init({el:this.torrents_element,active:!0});this.feeds=Feeds.init({el:this.feeds_element,active:!1});this.settings=Settings.init({el:this.settings_element});this.sidebar=Sidebar.init({el:this.sidebar_element});this.panels=Panels.init({el:this.panel_element});this.controls=Controls.init({el:this.controls_element});
e.bind("activateController",this.proxy(this.activateController));e.bind("logoutUser",this.proxy(this.logoutUser));this.manage("torrents","feeds");this.activateController("torrents");Handlebars.registerHelper("parseBytes",function(a){return App.parseBytes(a)});Handlebars.registerHelper("secondsToDate",function(a){return App.secondsToDate(a)});Handlebars.registerHelper("relativeDate",function(a){a=(new Date).getTime()/1E3-a;return App.secondsToString(a)});Handlebars.registerHelper("secondsToString",
function(a){return App.secondsToString(a)});this.loadToken();b(window).bind("orientationchange",function(){e.trigger("closeModals")});this.el.bind("tap",function(){e.trigger("closeModals")});this.el.on("tap",".open_sessions",this.openSessions)},logoutUser:function(a){a=(a=a||"Logged out successfully from remote.","/talon/logout?message="+encodeURIComponent(a));window.top?window.top.location=a:window.location=a},getSelected:function(){return this.torrents.current},openSessions:function(){var a=decode_location_params(),
a=a&&a.sessions?"?sessions="+encodeURIComponent(a.sessions):"";window.open("/talon/sessions"+a)},loadToken:function(){var a=this;this.token_tries--;client.raptor.api.get_token(function(){b(document).data("token",client.raptor.api.token);!a.torrents.first_load&&a.torrents.loadAll();!a.settings.first_load&&a.settings.loadAll()},function(b){console.log(b);0==a.token_tries?a.logoutUser("An error occurred, please log in again."):a.loadToken()})},parseBytes:function(a){var b;if(0>=a||!a)return"0 b";b=Math.floor(Math.log(a)/
Math.log(1024));a/=Math.pow(1024,b);rounded=Math.round(100*a)/100;return rounded+" "+"b kB MB GB TB PB EB ZB YB".split(" ")[b]},secondsToDate:function(a){if(!a)return"n/a";a=new Date(1E3*a);return a.getDate()+"/"+a.getMonth()+"/"+a.getFullYear()},secondsToString:function(a,b){if(-1==a||!a)return"\u221e";var d=Number(a);if(63072E3<d)return b?"":"\u221e";var e,g,h,j,k;g="";g=Math.floor(d/31536E3);e=d%31536E3;d=Math.floor(e/604800);e%=604800;h=Math.floor(e/86400);e%=86400;j=Math.floor(e/3600);e%=3600;
k=Math.floor(e/60);e%=60;return g=0<g?"%dy %dw".replace(/%d/,g).replace(/%d/,d):0<d?"%dw %dd".replace(/%d/,d).replace(/%d/,h):0<h?"%dd %dh".replace(/%d/,h).replace(/%d/,j):0<j?"%dh %dm".replace(/%d/,j).replace(/%d/,k):0<k?"%dm %ds".replace(/%d/,k).replace(/%d/,e):"%ds".replace(/%d/,e)}})})(Spine,Spine.$);$(function(){window.App=uTorrentApp.init()});
